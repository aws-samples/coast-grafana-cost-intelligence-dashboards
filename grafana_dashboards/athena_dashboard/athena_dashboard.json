{
  "__inputs": [
    {
      "name": "DS_GRAFANA-DASHBOARDS-ATHENA",
      "label": "grafana-dashboards-athena",
      "description": "",
      "type": "datasource",
      "pluginId": "grafana-athena-datasource",
      "pluginName": "Amazon Athena"
    },
    {
      "name": "DS_GRAFANA-DASHBOARDS-CLOUDWATCH",
      "label": "grafana-dashboards-cloudwatch",
      "description": "",
      "type": "datasource",
      "pluginId": "cloudwatch",
      "pluginName": "CloudWatch"
    }
  ],
  "__elements": {},
  "__requires": [
    {
      "type": "panel",
      "id": "barchart",
      "name": "Bar chart",
      "version": ""
    },
    {
      "type": "datasource",
      "id": "cloudwatch",
      "name": "CloudWatch",
      "version": "1.0.0"
    },
    {
      "type": "grafana",
      "id": "grafana",
      "name": "Grafana",
      "version": "10.4.1"
    },
    {
      "type": "datasource",
      "id": "grafana-athena-datasource",
      "name": "Amazon Athena",
      "version": "3.1.6"
    },
    {
      "type": "panel",
      "id": "stat",
      "name": "Stat",
      "version": ""
    },
    {
      "type": "panel",
      "id": "text",
      "name": "Text",
      "version": ""
    },
    {
      "type": "panel",
      "id": "timeseries",
      "name": "Time series",
      "version": ""
    }
  ],
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": {
          "type": "grafana",
          "uid": "-- Grafana --"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": null,
  "links": [
    {
      "asDropdown": true,
      "icon": "external link",
      "includeVars": true,
      "keepTime": true,
      "tags": [],
      "targetBlank": true,
      "title": "Dashboards",
      "tooltip": "",
      "type": "dashboards",
      "url": ""
    },
    {
      "asDropdown": false,
      "icon": "doc",
      "includeVars": false,
      "keepTime": false,
      "tags": [],
      "targetBlank": true,
      "title": "CloudWatch Athena Metrics",
      "tooltip": "Open to learn about CloudWatch Athena metrics",
      "type": "link",
      "url": "https://docs.aws.amazon.com/athena/latest/ug/query-metrics-viewing.html"
    }
  ],
  "panels": [
    {
      "description": "",
      "gridPos": {
        "h": 10,
        "w": 24,
        "x": 0,
        "y": 0
      },
      "id": 2,
      "links": [
        {
          "targetBlank": true,
          "title": "Athena CloudWatch Metrics ",
          "url": "https://docs.aws.amazon.com/athena/latest/ug/query-metrics-viewing.html"
        },
        {
          "targetBlank": true,
          "title": "Athena Provisioned Capacity",
          "url": "https://aws.amazon.com/blogs/aws/introducing-athena-provisioned-capacity/"
        }
      ],
      "options": {
        "code": {
          "language": "plaintext",
          "showLineNumbers": false,
          "showMiniMap": false
        },
        "content": "<div><h3>Athena Dashboard</h3></div> \n<p>\nThe Athena Dashboard displays AWS Athena cost, usage and performance metric information filtered by account and region. \nOne section also filters by tag. The filter panel will refresh based on selections of previous filters. \nFor example, when an account is selected the Region menu will only show regions, workgroups and tags observed in that account for the time period selected. \n</p>\n\n<div><h5>Section Overview</h5></div>\n<div>\n  <ol>\n<li>Overview Section - A general overview of Athena Spend and related CloudWatch Metrics.</li>\n<li>Tag Explorer - A collection of visuals displaying Cost and Usage grouped by the selected Tag and Value (CloudWatch is not supported with tagging)</li>\n</ol>\n</p>\n\n<p>\nReminder: Change the Athena Database name and Table name in the variables section if you customized these values.  \nThe Athena Database is currently set to **${CURDatabase}**.  The Table is currently set to **${CURTable}**.\n<br><br>\nThis dashboard depends on <a href=\"https://docs.aws.amazon.com/cur/latest/userguide/table-dictionary-cur2.html\" target=\"_blank\">CUR version 2</a> and <a href=\"https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CloudWatch-Unified-Cross-Account.html\" target=\"_blank\">CloudWatch (cross-account) metrics</a> being available in the data collection account.  \n</p>\n\n</div>",
        "mode": "html"
      },
      "pluginVersion": "10.4.1",
      "type": "text"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 10
      },
      "id": 15,
      "panels": [],
      "title": "Athena Overview - ${AccountId} in ${Region}",
      "type": "row"
    },
    {
      "datasource": {
        "type": "datasource",
        "uid": "-- Mixed --"
      },
      "description": "Athena cost ",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "continuous-GrYlRd"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 20,
            "gradientMode": "scheme",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "smooth",
            "lineWidth": 3,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 11
      },
      "id": 27,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "hidden",
          "placement": "right",
          "showLegend": false
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "pluginVersion": "10.4.1",
      "targets": [
        {
          "connectionArgs": {
            "catalog": "__default",
            "database": "__default",
            "region": "__default",
            "resultReuseEnabled": false,
            "resultReuseMaxAgeInMinutes": 60
          },
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "${DS_GRAFANA-DASHBOARDS-ATHENA}"
          },
          "format": 1,
          "hide": false,
          "rawSQL": "SELECT \nDATE_TRUNC('${CURGranularity}', line_item_usage_start_date) as line_item_usage_start_date,\nSPLIT_PART(SPLIT_PART(line_item_resource_id, ':',  6), '/', 2) as workgroup,\nSUM(line_item_unblended_cost) as unblended_cost\nFROM ${CURDatabase}.${CURTable}\nWHERE \n$__timeFilter(line_item_usage_start_date)\nAND line_item_product_code = 'AmazonAthena'\nAND line_item_line_item_type in ('Usage')\nAND line_item_usage_account_id = '${AccountId}'\nAND product_region_code = '${Region}'\nGROUP BY\nDATE_TRUNC('${CURGranularity}', line_item_usage_start_date),\nSPLIT_PART(SPLIT_PART(line_item_resource_id, ':',  6), '/', 2)\nORDER BY\nline_item_usage_start_date DESC\n",
          "refId": "CUR"
        }
      ],
      "title": "Athena Cost for ${AccountId} in ${Region}",
      "transformations": [
        {
          "id": "groupBy",
          "options": {
            "fields": {
              "line_item_usage_start_date": {
                "aggregations": [],
                "operation": "groupby"
              },
              "unblended_cost": {
                "aggregations": [],
                "operation": "groupby"
              },
              "workgroup": {
                "aggregations": [],
                "operation": "groupby"
              }
            }
          }
        }
      ],
      "transparent": true,
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "datasource",
        "uid": "-- Mixed --"
      },
      "description": "Athena cost: ${__from:date:iso} - ${__to:date:iso}",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "displayName": "Unblended Cost",
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 11
      },
      "id": 12,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "10.4.1",
      "targets": [
        {
          "connectionArgs": {
            "catalog": "__default",
            "database": "__default",
            "region": "__default",
            "resultReuseEnabled": false,
            "resultReuseMaxAgeInMinutes": 60
          },
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "${DS_GRAFANA-DASHBOARDS-ATHENA}"
          },
          "format": 1,
          "hide": false,
          "rawSQL": "SELECT \nSUM(line_item_unblended_cost) AS cost\nFROM ${CURDatabase}.${CURTable}\nWHERE \n$__timeFilter(line_item_usage_start_date)\nAND line_item_product_code = 'AmazonAthena'\nAND line_item_line_item_type in ('Usage')\nAND line_item_usage_account_id = '${AccountId}'\nAND product_region_code = '${Region}';\n\n",
          "refId": "CUR"
        }
      ],
      "title": "Athena Cost for ${AccountId} in ${Region} - ${__from:date:iso} - ${__to:date:iso}",
      "transparent": true,
      "type": "stat"
    },
    {
      "datasource": {
        "type": "datasource",
        "uid": "-- Mixed --"
      },
      "description": "Athena Cost from CUR for Workgroup: ${Workgroup}. CloudWatch ProcessedBytes measures the number of bytes that Athena scanned per DML query.  Metrics are separated into SUCCEEDED, FAILED, and CANCELED queries. ",
      "fieldConfig": {
        "defaults": {
          "color": {
            "fixedColor": "dark-purple",
            "mode": "shades"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "Processed Bytes",
            "axisPlacement": "right",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "smooth",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "decbytes"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byFrameRefID",
              "options": "CUR"
            },
            "properties": [
              {
                "id": "custom.axisLabel",
                "value": "Cost"
              },
              {
                "id": "custom.axisPlacement",
                "value": "left"
              },
              {
                "id": "unit",
                "value": "currencyUSD"
              },
              {
                "id": "displayName",
                "value": "Cost"
              },
              {
                "id": "color",
                "value": {
                  "mode": "continuous-GrYlRd"
                }
              },
              {
                "id": "custom.lineWidth",
                "value": 3
              },
              {
                "id": "custom.lineStyle",
                "value": {
                  "fill": "solid"
                }
              },
              {
                "id": "custom.fillOpacity",
                "value": 20
              },
              {
                "id": "custom.lineInterpolation",
                "value": "smooth"
              },
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "color": "green",
                      "value": null
                    },
                    {
                      "color": "red",
                      "value": 80
                    }
                  ]
                }
              },
              {
                "id": "custom.gradientMode",
                "value": "scheme"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "FAILED"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "#fbab00",
                  "mode": "shades"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "CANCELED"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "#0016ff",
                  "mode": "shades"
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 19
      },
      "id": 30,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "multi",
          "sort": "none"
        }
      },
      "targets": [
        {
          "connectionArgs": {
            "catalog": "__default",
            "database": "__default",
            "region": "__default",
            "resultReuseEnabled": false,
            "resultReuseMaxAgeInMinutes": 60
          },
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "${DS_GRAFANA-DASHBOARDS-ATHENA}"
          },
          "format": 1,
          "hide": false,
          "rawSQL": "SELECT \nDATE_TRUNC('${CURGranularity}', line_item_usage_start_date) as line_item_usage_start_date,\nSPLIT_PART(SPLIT_PART(line_item_resource_id, ':',  6), '/', 2) as workgroup,\nSUM(line_item_unblended_cost) as unblended_cost\nFROM ${CURDatabase}.${CURTable}\nWHERE \n$__timeFilter(line_item_usage_start_date)\nAND line_item_product_code = 'AmazonAthena'\nAND line_item_line_item_type in ('Usage')\nAND line_item_usage_account_id = '${AccountId}'\nAND product_region_code = '${Region}'\nAND SPLIT_PART(SPLIT_PART(line_item_resource_id, ':',  6), '/', 2) = '${Workgroup}'\nGROUP BY\nDATE_TRUNC('${CURGranularity}', line_item_usage_start_date),\nSPLIT_PART(SPLIT_PART(line_item_resource_id, ':',  6), '/', 2)\nORDER BY\nline_item_usage_start_date DESC\n",
          "refId": "CUR"
        },
        {
          "accountId": "all",
          "datasource": {
            "type": "cloudwatch",
            "uid": "${DS_GRAFANA-DASHBOARDS-CLOUDWATCH}"
          },
          "dimensions": {},
          "expression": "REMOVE_EMPTY(SEARCH('{\"AWS/Athena\",\"QueryState\",\"QueryType\",\"WorkGroup\"} \"ProcessedBytes\" WorkGroup=\"${Workgroup}\" :aws.AccountId=\"${AccountId}\"', 'Average', ${CWGranularity}))",
          "hide": false,
          "id": "",
          "label": "",
          "logGroups": [],
          "matchExact": true,
          "metricEditorMode": 1,
          "metricName": "",
          "metricQueryType": 0,
          "namespace": "",
          "period": "",
          "queryMode": "Metrics",
          "refId": "CW",
          "region": "$Region",
          "sqlExpression": "",
          "statistic": "Average"
        },
        {
          "accountId": "all",
          "datasource": {
            "type": "cloudwatch",
            "uid": "${DS_GRAFANA-DASHBOARDS-CLOUDWATCH}"
          },
          "dimensions": {},
          "expression": "REMOVE_EMPTY(SEARCH('{\"AWS/Athena\",\"QueryState\",\"QueryType\",\"WorkGroup\"} \"ProcessedBytes\" QueryState=\"FAILED\" WorkGroup=\"${Workgroup}\" :aws.AccountId=\"${AccountId}\"', 'Average', ${CWGranularity}))",
          "hide": true,
          "id": "",
          "label": "",
          "logGroups": [],
          "matchExact": true,
          "metricEditorMode": 1,
          "metricName": "",
          "metricQueryType": 0,
          "namespace": "",
          "period": "",
          "queryMode": "Metrics",
          "refId": "CWFAILED",
          "region": "$Region",
          "sqlExpression": "",
          "statistic": "Average"
        },
        {
          "accountId": "all",
          "datasource": {
            "type": "cloudwatch",
            "uid": "${DS_GRAFANA-DASHBOARDS-CLOUDWATCH}"
          },
          "dimensions": {},
          "expression": "REMOVE_EMPTY(SEARCH('{\"AWS/Athena\",\"QueryState\",\"QueryType\",\"WorkGroup\"} \"ProcessedBytes\" QueryState=\"CANCELED\" WorkGroup=\"${Workgroup}\" :aws.AccountId=\"${AccountId}\"', 'Average', ${CWGranularity}))",
          "hide": true,
          "id": "",
          "label": "",
          "logGroups": [],
          "matchExact": true,
          "metricEditorMode": 1,
          "metricName": "",
          "metricQueryType": 0,
          "namespace": "",
          "period": "",
          "queryMode": "Metrics",
          "refId": "CWCANCELED",
          "region": "$Region",
          "sqlExpression": "",
          "statistic": "Average"
        }
      ],
      "title": "Athena Cost over ProcessedBytes for WorkGroup: ${Workgroup}",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "datasource",
        "uid": "-- Mixed --"
      },
      "description": "Athena Spend by workgroup in  ${AccountId} in ${Region} - ${__from:date:iso} - ${__to:date:iso}",
      "fieldConfig": {
        "defaults": {
          "color": {
            "fixedColor": "dark-green",
            "mode": "shades"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "Workgroup Cost",
            "axisPlacement": "auto",
            "axisSoftMin": 5,
            "fillOpacity": 80,
            "gradientMode": "hue",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineWidth": 1,
            "scaleDistribution": {
              "type": "linear"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "displayName": "Workgroup",
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 19
      },
      "id": 14,
      "options": {
        "barRadius": 0,
        "barWidth": 0.86,
        "fullHighlight": false,
        "groupWidth": 0.7,
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "orientation": "horizontal",
        "showValue": "auto",
        "stacking": "none",
        "tooltip": {
          "mode": "multi",
          "sort": "none"
        },
        "xTickLabelRotation": 0,
        "xTickLabelSpacing": 100
      },
      "pluginVersion": "10.4.1",
      "targets": [
        {
          "connectionArgs": {
            "catalog": "__default",
            "database": "__default",
            "region": "__default",
            "resultReuseEnabled": false,
            "resultReuseMaxAgeInMinutes": 60
          },
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "${DS_GRAFANA-DASHBOARDS-ATHENA}"
          },
          "format": 1,
          "hide": false,
          "rawSQL": "SELECT DISTINCT \n    SPLIT_PART(SPLIT_PART(line_item_resource_id, ':', 6), '/', 2) as workgroup,\n    SUM(line_item_unblended_cost) as cost\nFROM ${CURDatabase}.${CURTable}\nWHERE \n$__timeFilter(line_item_usage_start_date)\nAND line_item_product_code = 'AmazonAthena'\nAND line_item_line_item_type in ('Usage')\nAND line_item_usage_account_id = '${AccountId}'\nAND product_region_code = '${Region}'\nGROUP BY\nSPLIT_PART(SPLIT_PART(line_item_resource_id, ':', 6), '/', 2)\nORDER BY \nworkgroup DESC;",
          "refId": "InstanceTypes"
        }
      ],
      "title": "Athena Spend by workgroup in  ${AccountId} in ${Region} - ${__from:date:iso} - ${__to:date:iso}",
      "transparent": true,
      "type": "barchart"
    },
    {
      "datasource": {
        "type": "datasource",
        "uid": "-- Mixed --"
      },
      "description": "The number of milliseconds that Athena took to run a DDL or DML query.  for Workgroup: ${Workgroup}",
      "fieldConfig": {
        "defaults": {
          "color": {
            "fixedColor": "dark-purple",
            "mode": "shades"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "Processed Bytes",
            "axisPlacement": "right",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "smooth",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "ms"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "FAILED DML"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "#fbab00",
                  "mode": "shades"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "CANCELED DML"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "#0016ff",
                  "mode": "shades"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "SUCCEEDED UTILITY"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "dark-green",
                  "mode": "shades"
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 27
      },
      "id": 31,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "multi",
          "sort": "none"
        }
      },
      "targets": [
        {
          "accountId": "all",
          "datasource": {
            "type": "cloudwatch",
            "uid": "${DS_GRAFANA-DASHBOARDS-CLOUDWATCH}"
          },
          "dimensions": {},
          "expression": "REMOVE_EMPTY(SEARCH('{\"AWS/Athena\",\"QueryState\",\"QueryType\",\"WorkGroup\"} \"TotalExecutionTime\" WorkGroup=\"${Workgroup}\" :aws.AccountId=\"${AccountId}\"', 'Average', ${CWGranularity}))",
          "hide": false,
          "id": "",
          "label": "",
          "logGroups": [],
          "matchExact": true,
          "metricEditorMode": 1,
          "metricName": "",
          "metricQueryType": 0,
          "namespace": "",
          "period": "",
          "queryMode": "Metrics",
          "refId": "CW",
          "region": "$Region",
          "sqlExpression": "",
          "statistic": "Average"
        }
      ],
      "title": "Athena TotalExecutionTime for WorkGroup: ${Workgroup}",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "datasource",
        "uid": "-- Mixed --"
      },
      "description": "The number of milliseconds that the query was in the query queue waiting for resources for Workgroup: ${Workgroup}",
      "fieldConfig": {
        "defaults": {
          "color": {
            "fixedColor": "dark-purple",
            "mode": "shades"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "Processed Bytes",
            "axisPlacement": "right",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "smooth",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "ms"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "FAILED DML"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "#fbab00",
                  "mode": "shades"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "CANCELED DML"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "#0016ff",
                  "mode": "shades"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "SUCCEEDED UTILITY"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "dark-green",
                  "mode": "shades"
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 27
      },
      "id": 32,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "multi",
          "sort": "none"
        }
      },
      "targets": [
        {
          "accountId": "all",
          "datasource": {
            "type": "cloudwatch",
            "uid": "${DS_GRAFANA-DASHBOARDS-CLOUDWATCH}"
          },
          "dimensions": {},
          "expression": "REMOVE_EMPTY(SEARCH('{\"AWS/Athena\",\"QueryState\",\"QueryType\",\"WorkGroup\"} \"QueryQueueTime\" WorkGroup=\"${Workgroup}\" :aws.AccountId=\"${AccountId}\"', 'Average', ${CWGranularity}))",
          "hide": false,
          "id": "",
          "label": "",
          "logGroups": [],
          "matchExact": true,
          "metricEditorMode": 1,
          "metricName": "",
          "metricQueryType": 0,
          "namespace": "",
          "period": "",
          "queryMode": "Metrics",
          "refId": "CW",
          "region": "$Region",
          "sqlExpression": "",
          "statistic": "Average"
        }
      ],
      "title": "Athena QueryQueueTime for WorkGroup: ${Workgroup}",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 35
      },
      "id": 33,
      "panels": [],
      "title": "Tag Explorer",
      "type": "row"
    },
    {
      "datasource": {
        "type": "datasource",
        "uid": "-- Mixed --"
      },
      "description": "Athena cost -  Tag: (${TagKey}, ${TagValue})",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "continuous-GrYlRd"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 20,
            "gradientMode": "scheme",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "smooth",
            "lineWidth": 3,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 36
      },
      "id": 34,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "hidden",
          "placement": "right",
          "showLegend": false
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "pluginVersion": "10.4.1",
      "targets": [
        {
          "connectionArgs": {
            "catalog": "__default",
            "database": "__default",
            "region": "__default",
            "resultReuseEnabled": false,
            "resultReuseMaxAgeInMinutes": 60
          },
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "${DS_GRAFANA-DASHBOARDS-ATHENA}"
          },
          "format": 1,
          "hide": false,
          "rawSQL": "SELECT \nDATE_TRUNC('${CURGranularity}', line_item_usage_start_date) as line_item_usage_start_date,\nSPLIT_PART(SPLIT_PART(line_item_resource_id, ':',  6), '/', 2) as workgroup,\nSUM(line_item_unblended_cost) as unblended_cost\nFROM ${CURDatabase}.${CURTable}\nWHERE \n$__timeFilter(line_item_usage_start_date)\nAND line_item_product_code = 'AmazonAthena'\nAND line_item_line_item_type in ('Usage')\nAND line_item_usage_account_id = '${AccountId}'\nAND product_region_code = '${Region}'\nAND resource_tags['${TagKey}'] = '${TagValue}'\nGROUP BY\nDATE_TRUNC('${CURGranularity}', line_item_usage_start_date),\nSPLIT_PART(SPLIT_PART(line_item_resource_id, ':',  6), '/', 2)\nORDER BY\nline_item_usage_start_date DESC\n",
          "refId": "CUR"
        }
      ],
      "title": "Athena Cost for ${AccountId} in ${Region} -  Tag: (${TagKey}, ${TagValue})",
      "transformations": [
        {
          "id": "groupBy",
          "options": {
            "fields": {
              "line_item_usage_start_date": {
                "aggregations": [],
                "operation": "groupby"
              },
              "unblended_cost": {
                "aggregations": [],
                "operation": "groupby"
              },
              "workgroup": {
                "aggregations": [],
                "operation": "groupby"
              }
            }
          }
        }
      ],
      "transparent": true,
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "datasource",
        "uid": "-- Mixed --"
      },
      "description": "Athena cost -  Tag: (${TagKey}, ${TagValue}) -  ${__from:date:iso} - ${__to:date:iso}",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "displayName": "Unblended Cost",
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 36
      },
      "id": 35,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "10.4.1",
      "targets": [
        {
          "connectionArgs": {
            "catalog": "__default",
            "database": "__default",
            "region": "__default",
            "resultReuseEnabled": false,
            "resultReuseMaxAgeInMinutes": 60
          },
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "${DS_GRAFANA-DASHBOARDS-ATHENA}"
          },
          "format": 1,
          "hide": false,
          "rawSQL": "SELECT \nSUM(line_item_unblended_cost) AS cost\nFROM ${CURDatabase}.${CURTable}\nWHERE \n$__timeFilter(line_item_usage_start_date)\nAND line_item_product_code = 'AmazonAthena'\nAND line_item_line_item_type in ('Usage')\nAND line_item_usage_account_id = '${AccountId}'\nAND product_region_code = '${Region}'\nAND resource_tags['${TagKey}'] = '${TagValue}';\n\n",
          "refId": "CUR"
        }
      ],
      "title": "Athena Cost for ${AccountId} in ${Region} -  Tag: (${TagKey}, ${TagValue}) ",
      "transparent": true,
      "type": "stat"
    }
  ],
  "refresh": "",
  "schemaVersion": 39,
  "tags": [],
  "templating": {
    "list": [
      {
        "current": {
          "selected": false,
          "text": "grafana-dashboards-athena",
          "value": "ber8a0v9qmhhcc"
        },
        "description": "Athena CUR Table connection for queries to AWS Cost and Usage",
        "hide": 2,
        "includeAll": false,
        "label": "CUR Datasource",
        "multi": false,
        "name": "CURDatasource",
        "options": [],
        "query": "grafana-athena-datasource",
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "type": "datasource"
      },
      {
        "current": {
          "selected": false,
          "text": "grafana-dashboards-cloudwatch",
          "value": "cer8a0l7ryq68e"
        },
        "description": "CloudWatch Datasource, for queries to metrics and logs",
        "hide": 2,
        "includeAll": false,
        "label": "CW Datasource",
        "multi": false,
        "name": "CWDatasource",
        "options": [],
        "query": "cloudwatch",
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "type": "datasource"
      },
      {
        "current": {
          "selected": false,
          "text": "cur2",
          "value": "cur2"
        },
        "description": "CUR Table name; change if not cur2",
        "hide": 2,
        "includeAll": false,
        "label": "CUR Table",
        "multi": false,
        "name": "CURTable",
        "options": [
          {
            "selected": true,
            "text": "cur2",
            "value": "cur2"
          }
        ],
        "query": "cur2",
        "skipUrlSync": false,
        "type": "custom"
      },
      {
        "current": {
          "selected": false,
          "text": "cid_data_export",
          "value": "cid_data_export"
        },
        "description": "CUR Database; change this name ",
        "hide": 2,
        "includeAll": false,
        "label": "CUR Database",
        "multi": false,
        "name": "CURDatabase",
        "options": [
          {
            "selected": true,
            "text": "cid_data_export",
            "value": "cid_data_export"
          }
        ],
        "query": "cid_data_export",
        "skipUrlSync": false,
        "type": "custom"
      },
      {
        "current": {},
        "datasource": {
          "type": "grafana-athena-datasource",
          "uid": "${DS_GRAFANA-DASHBOARDS-ATHENA}"
        },
        "definition": "",
        "description": "All account IDs found in the CUR for look back period.",
        "hide": 0,
        "includeAll": false,
        "label": "Account ID",
        "multi": false,
        "name": "AccountId",
        "options": [],
        "query": {
          "connectionArgs": {
            "catalog": "__default",
            "database": "__default",
            "region": "__default",
            "resultReuseEnabled": false,
            "resultReuseMaxAgeInMinutes": 60
          },
          "format": 1,
          "rawSQL": "SELECT \nDISTINCT line_item_usage_account_id\nFROM ${CURDatabase}.${CURTable}\nWHERE \n$__timeFilter(line_item_usage_start_date);"
        },
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "sort": 0,
        "type": "query"
      },
      {
        "current": {},
        "datasource": {
          "type": "grafana-athena-datasource",
          "uid": "${DS_GRAFANA-DASHBOARDS-ATHENA}"
        },
        "definition": "",
        "description": "Regions observed in the CUR over the look back period",
        "hide": 0,
        "includeAll": false,
        "label": "Region",
        "multi": false,
        "name": "Region",
        "options": [],
        "query": {
          "connectionArgs": {
            "catalog": "__default",
            "database": "__default",
            "region": "__default",
            "resultReuseEnabled": false,
            "resultReuseMaxAgeInMinutes": 60
          },
          "format": 1,
          "rawSQL": "SELECT \nDISTINCT product_region_code,\nCASE \n    WHEN product_region_code = 'us-east-1' THEN 0\n    ELSE 1\nEND AS sort_order\nFROM ${CURDatabase}.${CURTable}\nWHERE \n$__timeFilter(line_item_usage_start_date)\nAND line_item_usage_account_id = '${AccountId}'\nAND product_region_code != ''\nORDER BY\nsort_order,\nproduct_region_code"
        },
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "sort": 0,
        "type": "query"
      },
      {
        "current": {},
        "datasource": {
          "type": "grafana-athena-datasource",
          "uid": "${DS_GRAFANA-DASHBOARDS-ATHENA}"
        },
        "definition": "",
        "description": "Athena Workgroup found in the CUR for time period.",
        "hide": 0,
        "includeAll": false,
        "label": "Workgroup",
        "multi": false,
        "name": "Workgroup",
        "options": [],
        "query": {
          "connectionArgs": {
            "catalog": "__default",
            "database": "__default",
            "region": "__default",
            "resultReuseEnabled": false,
            "resultReuseMaxAgeInMinutes": 60
          },
          "format": 1,
          "rawSQL": "SELECT\nSPLIT_PART(SPLIT_PART(line_item_resource_id, ':', 6), '/', 2) as workgroup\nFROM ${CURDatabase}.${CURTable}\nWHERE \n$__timeFilter(line_item_usage_start_date) \nAND line_item_product_code = 'AmazonAthena'\nAND line_item_line_item_type in ('Usage')\nAND line_item_usage_account_id = '${AccountId}'\nAND product_region_code = '${Region}';"
        },
        "refresh": 2,
        "regex": "",
        "skipUrlSync": false,
        "sort": 0,
        "type": "query"
      },
      {
        "current": {
          "selected": false,
          "text": "day",
          "value": "day"
        },
        "description": "Select the Granularity for CUR data points",
        "hide": 0,
        "includeAll": false,
        "label": "CUR Granularity",
        "multi": false,
        "name": "CURGranularity",
        "options": [
          {
            "selected": false,
            "text": "hour",
            "value": "hour"
          },
          {
            "selected": true,
            "text": "day",
            "value": "day"
          },
          {
            "selected": false,
            "text": "week",
            "value": "week"
          },
          {
            "selected": false,
            "text": "month",
            "value": "month"
          }
        ],
        "query": "hour,day,week,month",
        "queryValue": "",
        "skipUrlSync": false,
        "type": "custom"
      },
      {
        "current": {
          "selected": false,
          "text": "86400",
          "value": "86400"
        },
        "description": "Select the Granularity for CloudWatch data points in seconds.  \n\n300 = 5 minutes, 3600 = 1 hour, 86400 = 1 day, 604800 = 1 week, 2592000 = 1 month",
        "hide": 0,
        "includeAll": false,
        "label": "CloudWatch Granularity (s)",
        "multi": false,
        "name": "CWGranularity",
        "options": [
          {
            "selected": false,
            "text": "300",
            "value": "300"
          },
          {
            "selected": false,
            "text": "3600",
            "value": "3600"
          },
          {
            "selected": true,
            "text": "86400",
            "value": "86400"
          },
          {
            "selected": false,
            "text": "604800",
            "value": "604800"
          },
          {
            "selected": false,
            "text": "2592000",
            "value": "2592000"
          }
        ],
        "query": "300,3600,86400,604800,2592000",
        "queryValue": "",
        "skipUrlSync": false,
        "type": "custom"
      },
      {
        "current": {},
        "datasource": {
          "type": "grafana-athena-datasource",
          "uid": "${DS_GRAFANA-DASHBOARDS-ATHENA}"
        },
        "definition": "",
        "description": "Tag Key extracted from CUR and observed in the past 30 days",
        "hide": 0,
        "includeAll": false,
        "label": "Tag Key",
        "multi": false,
        "name": "TagKey",
        "options": [],
        "query": {
          "connectionArgs": {
            "catalog": "__default",
            "database": "__default",
            "region": "__default",
            "resultReuseEnabled": false,
            "resultReuseMaxAgeInMinutes": 60
          },
          "format": 1,
          "rawSQL": "WITH all_keys AS (\n  SELECT ARRAY_DISTINCT(ARRAY_AGG(key)) AS unique_keys\n  FROM ${CURDatabase}.${CURTable}\n  CROSS JOIN UNNEST(MAP_KEYS(resource_tags)) AS t(key)\n  WHERE \n  $__timeFilter(line_item_usage_start_date)\n  AND line_item_usage_account_id = '${AccountId}'\n  AND product_region_code = '${Region}'\n  -- AND line_item_usage_start_date >= ${__from:date:iso} AND line_item_usage_start_date <= ${__to:date:iso} \n  -- AND line_item_usage_start_date >= CAST('${__from:date:YYYY-MM-DD}' as date)\n  -- AND line_item_usage_start_date <= CAST('${__to:date:YYYY-MM-DD}' as date)\n)\n\nSELECT key AS unique_key\nFROM all_keys\nCROSS JOIN UNNEST(unique_keys) AS t(key)"
        },
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "sort": 0,
        "type": "query"
      },
      {
        "current": {},
        "datasource": {
          "type": "grafana-athena-datasource",
          "uid": "${DS_GRAFANA-DASHBOARDS-ATHENA}"
        },
        "definition": "",
        "hide": 0,
        "includeAll": false,
        "label": "TagValue",
        "multi": false,
        "name": "TagValue",
        "options": [],
        "query": {
          "connectionArgs": {
            "catalog": "__default",
            "database": "__default",
            "region": "__default",
            "resultReuseEnabled": false,
            "resultReuseMaxAgeInMinutes": 60
          },
          "format": 1,
          "rawSQL": "SELECT \n  resource_tags['${TagKey}'] AS tag_value,\n  COUNT(*) AS count\nFROM ${CURDatabase}.${CURTable}\nWHERE \n  $__timeFilter(line_item_usage_start_date)\n  AND line_item_usage_account_id = '${AccountId}'\n  AND product_region_code = '${Region}'\n  AND resource_tags['${TagKey}'] IS NOT NULL\n  -- AND line_item_usage_start_date >= CAST('${__from:date:YYYY-MM-DD}' as date)\n  -- AND line_item_usage_start_date <= CAST('${__to:date:YYYY-MM-DD}' as date)\nGROUP BY resource_tags['${TagKey}']\nORDER BY count DESC;"
        },
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "sort": 0,
        "type": "query"
      }
    ]
  },
  "time": {
    "from": "now-30d",
    "to": "now-1440m"
  },
  "timepicker": {
    "hidden": false,
    "nowDelay": "1440m"
  },
  "timezone": "browser",
  "title": "Athena Dashboard",
  "uid": "eermzld59o2kgc",
  "version": 51,
  "weekStart": ""
}