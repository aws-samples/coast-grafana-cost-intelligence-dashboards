{
  "__inputs": [
    {
      "name": "DS_GRAFANA-DASHBOARDS-ATHENA",
      "label": "grafana-dashboards-athena",
      "description": "",
      "type": "datasource",
      "pluginId": "grafana-athena-datasource",
      "pluginName": "Amazon Athena"
    },
    {
      "name": "DS_GRAFANA-DASHBOARDS-CLOUDWATCH",
      "label": "grafana-dashboards-cloudwatch",
      "description": "",
      "type": "datasource",
      "pluginId": "cloudwatch",
      "pluginName": "CloudWatch"
    }
  ],
  "__elements": {},
  "__requires": [
    {
      "type": "panel",
      "id": "barchart",
      "name": "Bar chart",
      "version": ""
    },
    {
      "type": "datasource",
      "id": "cloudwatch",
      "name": "CloudWatch",
      "version": "1.0.0"
    },
    {
      "type": "grafana",
      "id": "grafana",
      "name": "Grafana",
      "version": "10.4.1"
    },
    {
      "type": "datasource",
      "id": "grafana-athena-datasource",
      "name": "Amazon Athena",
      "version": "3.1.6"
    },
    {
      "type": "panel",
      "id": "stat",
      "name": "Stat",
      "version": ""
    },
    {
      "type": "panel",
      "id": "table",
      "name": "Table",
      "version": ""
    },
    {
      "type": "panel",
      "id": "text",
      "name": "Text",
      "version": ""
    },
    {
      "type": "panel",
      "id": "timeseries",
      "name": "Time series",
      "version": ""
    }
  ],
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": {
          "type": "grafana",
          "uid": "-- Grafana --"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": null,
  "links": [],
  "panels": [
    {
      "description": "",
      "gridPos": {
        "h": 10,
        "w": 24,
        "x": 0,
        "y": 0
      },
      "id": 2,
      "options": {
        "code": {
          "language": "plaintext",
          "showLineNumbers": false,
          "showMiniMap": false
        },
        "content": "<div><h3>EC2 Instance Dashboard</h3></div> \n<p>\nThe EC2 Instance Dashboard displays EC2 instance compute cost, usage and performance metric information filtered by account and region.  One section also filters by tag.  \nThe filter panel will refresh based on selections of previous filters.  For example, when an account is selected the Region menu will only show regions, \ninstances and tags observed in that account for the time period selected.\n<br><br>\nCloudWatch metrics are available in certain graphs where a common key can be defined between CUR data and CloudWatch data (i.e. instance name).  For metrics \nto work correctly, you need the CloudWatch data source enabled.  For CloudWatch cross-account/cross-region to work correctly you need to have <a href=\"https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CloudWatch-Unified-Cross-Account.html\" target=\"_blank\">CloudWatch (cross-account) metrics</a>\nconfigured.\n</p>\n\n<div><h5>Section Overview</h5></div>\n<div>\n<p>\n  <ol>\n<li>Overview Section - A general overview of EC2 Spend.</li>\n<li>Tag Explorer - A collection of visuals displaying Cost and Usage grouped by the selected Tag and Value (CloudWatch is not supported with tagging)</li>\n<li>Instance Explorer -  A collection of visuals displaying Cost and Usage over CloudWatch Metrics for the selected instance</li>\n</ol>\n</p>\n\n<p>\nReminder: Change the Athena Database name and Table name in the variables section if you customized these values.  \nThe Athena Database is currently set to **${CURDatabase}**.  The Table is currently set to **${CURTable}**.\n<br><br>\nThis dashboard depends on <a href=\"https://docs.aws.amazon.com/cur/latest/userguide/table-dictionary-cur2.html\" target=\"_blank\">CUR version 2</a> and <a href=\"https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CloudWatch-Unified-Cross-Account.html\" target=\"_blank\">CloudWatch (cross-account) metrics</a> being available in the data collection account.  \n</p>\n</div>",
        "mode": "html"
      },
      "pluginVersion": "10.4.1",
      "type": "text"
    },
    {
      "collapsed": true,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 10
      },
      "id": 15,
      "panels": [
        {
          "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
          },
          "description": "Amortized cost for  EC2 Compute ",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "dark-green",
                "mode": "shades",
                "seriesBy": "max"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "series",
                "axisLabel": "Amortized Cost",
                "axisPlacement": "left",
                "axisSoftMin": 5,
                "axisWidth": 75,
                "barAlignment": 0,
                "drawStyle": "line",
                "fillOpacity": 25,
                "gradientMode": "opacity",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "smooth",
                "lineStyle": {
                  "dash": [
                    0,
                    10
                  ],
                  "fill": "dot"
                },
                "lineWidth": 1,
                "pointSize": 2,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "displayName": "Amortized Cost",
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green"
                  }
                ]
              },
              "unit": "currencyUSD"
            },
            "overrides": [
              {
                "matcher": {
                  "id": "byName",
                  "options": "unit_cost"
                },
                "properties": [
                  {
                    "id": "displayName",
                    "value": "unit_cost"
                  },
                  {
                    "id": "color",
                    "value": {
                      "fixedColor": "purple",
                      "mode": "shades"
                    }
                  },
                  {
                    "id": "custom.lineStyle"
                  },
                  {
                    "id": "custom.lineInterpolation",
                    "value": "smooth"
                  },
                  {
                    "id": "custom.fillOpacity",
                    "value": 0
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "count_instances"
                },
                "properties": [
                  {
                    "id": "displayName",
                    "value": "instance_count"
                  },
                  {
                    "id": "color",
                    "value": {
                      "fixedColor": "blue",
                      "mode": "shades"
                    }
                  },
                  {
                    "id": "unit",
                    "value": "none"
                  },
                  {
                    "id": "custom.axisPlacement",
                    "value": "right"
                  },
                  {
                    "id": "custom.axisLabel",
                    "value": "Instance Count"
                  }
                ]
              }
            ]
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 11
          },
          "id": 11,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "mode": "multi",
              "sort": "none"
            }
          },
          "targets": [
            {
              "connectionArgs": {
                "catalog": "__default",
                "database": "__default",
                "region": "__default",
                "resultReuseEnabled": false,
                "resultReuseMaxAgeInMinutes": 60
              },
              "datasource": {
                "type": "grafana-athena-datasource",
                "uid": "${DS_GRAFANA-DASHBOARDS-ATHENA}"
              },
              "format": 1,
              "hide": false,
              "rawSQL": "SELECT \nDATE_TRUNC('${CURGranularity}', line_item_usage_start_date) as line_item_usage_start_date,\nCOUNT(DISTINCT(line_item_resource_id)) as count_instances,\nSUM(CASE\n    WHEN line_item_line_item_type = 'SavingsPlanCoveredUsage' THEN savings_plan_savings_plan_effective_cost\n    WHEN line_item_line_item_type = 'DiscountedUsage' THEN reservation_effective_cost\n    WHEN line_item_line_item_type = 'Usage' THEN line_item_unblended_cost\n    ELSE 0 \n  END) AS amortized_cost\nFROM ${CURDatabase}.${CURTable}\nWHERE \n$__timeFilter(line_item_usage_start_date)\nAND line_item_product_code = 'AmazonEC2' \nAND line_item_operation LIKE '%RunInstances%' \nAND line_item_usage_type NOT LIKE '%DataXfer%' \nAND product_servicecode <> 'AWSDataTransfer' \nAND line_item_resource_id NOT LIKE 'arn:%:capacity-reservation/%'\nAND line_item_line_item_type in ('SavingsPlanCoveredUsage', 'Usage', 'DiscountedUsage')\nAND line_item_usage_account_id = '${AccountId}'\nAND product_region_code = '${Region}'\nGROUP BY\nDATE_TRUNC('${CURGranularity}', line_item_usage_start_date)\nORDER BY\nline_item_usage_start_date DESC\n",
              "refId": "CUR"
            }
          ],
          "title": "EC2 Compute Cost for ${AccountId} in ${Region}",
          "transformations": [
            {
              "id": "calculateField",
              "options": {
                "alias": "unit_cost",
                "binary": {
                  "left": "amortized_cost",
                  "operator": "/",
                  "right": "count_instances"
                },
                "mode": "binary",
                "reduce": {
                  "reducer": "sum"
                },
                "replaceFields": false
              }
            },
            {
              "id": "organize",
              "options": {
                "excludeByName": {
                  "count_instances": false
                },
                "includeByName": {},
                "indexByName": {},
                "renameByName": {}
              }
            }
          ],
          "transparent": true,
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
          },
          "description": "Amortized cost includes EC2 Compute: ${__from:date:iso} - ${__to:date:iso}",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "displayName": "Amortized Cost",
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green"
                  }
                ]
              },
              "unit": "currencyUSD"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 11
          },
          "id": 12,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "10.4.1",
          "targets": [
            {
              "connectionArgs": {
                "catalog": "__default",
                "database": "__default",
                "region": "__default",
                "resultReuseEnabled": false,
                "resultReuseMaxAgeInMinutes": 60
              },
              "datasource": {
                "type": "grafana-athena-datasource",
                "uid": "${DS_GRAFANA-DASHBOARDS-ATHENA}"
              },
              "format": 1,
              "hide": false,
              "rawSQL": "SELECT \nSUM(CASE\n    WHEN line_item_line_item_type = 'SavingsPlanCoveredUsage' THEN savings_plan_savings_plan_effective_cost\n    WHEN line_item_line_item_type = 'DiscountedUsage' THEN reservation_effective_cost\n    WHEN line_item_line_item_type = 'Usage' THEN line_item_unblended_cost\n    ELSE 0 \n  END) AS amortized_cost\nFROM ${CURDatabase}.${CURTable}\nWHERE \n$__timeFilter(line_item_usage_start_date)\nAND line_item_product_code = 'AmazonEC2' \nAND line_item_operation LIKE '%RunInstances%' \nAND line_item_usage_type NOT LIKE '%DataXfer%' \nAND product_servicecode <> 'AWSDataTransfer' \nAND line_item_resource_id NOT LIKE 'arn:%:capacity-reservation/%'\nAND line_item_line_item_type in ('SavingsPlanCoveredUsage', 'Usage', 'DiscountedUsage')\nAND line_item_usage_account_id = '${AccountId}'\nAND product_region_code = '${Region}';\n\n",
              "refId": "CUR"
            }
          ],
          "title": "EC2 Compute Cost for ${AccountId} in ${Region} - ${__from:date:iso} - ${__to:date:iso}",
          "transparent": true,
          "type": "stat"
        },
        {
          "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
          },
          "description": "Amortized cost for  EC2 Compute ",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "dark-green",
                "mode": "shades",
                "seriesBy": "max"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "series",
                "axisLabel": "Amortized Cost",
                "axisPlacement": "left",
                "axisSoftMin": 5,
                "axisWidth": 75,
                "barAlignment": 0,
                "drawStyle": "line",
                "fillOpacity": 25,
                "gradientMode": "opacity",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "smooth",
                "lineStyle": {
                  "dash": [
                    0,
                    10
                  ],
                  "fill": "dot"
                },
                "lineWidth": 1,
                "pointSize": 2,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "displayName": "Savings Plan Spend",
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green"
                  }
                ]
              },
              "unit": "currencyUSD"
            },
            "overrides": [
              {
                "matcher": {
                  "id": "byFrameRefID",
                  "options": "ReservedInstance"
                },
                "properties": [
                  {
                    "id": "color",
                    "value": {
                      "fixedColor": "dark-orange",
                      "mode": "shades"
                    }
                  },
                  {
                    "id": "custom.axisColorMode",
                    "value": "text"
                  },
                  {
                    "id": "displayName",
                    "value": "Reserved Instance Spend"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byFrameRefID",
                  "options": "OnDemand"
                },
                "properties": [
                  {
                    "id": "displayName",
                    "value": "OnDemand"
                  },
                  {
                    "id": "color",
                    "value": {
                      "fixedColor": "dark-purple",
                      "mode": "shades"
                    }
                  }
                ]
              }
            ]
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 19
          },
          "id": 13,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "mode": "multi",
              "sort": "none"
            }
          },
          "targets": [
            {
              "connectionArgs": {
                "catalog": "__default",
                "database": "__default",
                "region": "__default",
                "resultReuseEnabled": false,
                "resultReuseMaxAgeInMinutes": 60
              },
              "datasource": {
                "type": "grafana-athena-datasource",
                "uid": "${DS_GRAFANA-DASHBOARDS-ATHENA}"
              },
              "format": 1,
              "hide": false,
              "rawSQL": "SELECT \nDATE_TRUNC('${CURGranularity}', line_item_usage_start_date) as line_item_usage_start_date,\nSUM(CASE\n    WHEN line_item_line_item_type = 'SavingsPlanCoveredUsage' THEN savings_plan_savings_plan_effective_cost\n    ELSE 0 \n  END) AS savings_plan_spend\nFROM ${CURDatabase}.${CURTable}\nWHERE \n$__timeFilter(line_item_usage_start_date)\nAND line_item_product_code = 'AmazonEC2' \nAND line_item_operation LIKE '%RunInstances%' \nAND line_item_usage_type NOT LIKE '%DataXfer%' \nAND product_servicecode <> 'AWSDataTransfer' \nAND line_item_resource_id NOT LIKE 'arn:%:capacity-reservation/%'\nAND line_item_line_item_type in ('SavingsPlanCoveredUsage', 'Usage', 'DiscountedUsage')\nAND line_item_usage_account_id = '${AccountId}'\nAND product_region_code = '${Region}'\nGROUP BY\nDATE_TRUNC('${CURGranularity}', line_item_usage_start_date)\nORDER BY\nline_item_usage_start_date DESC\n",
              "refId": "SavingsPlan"
            },
            {
              "connectionArgs": {
                "catalog": "__default",
                "database": "__default",
                "region": "__default",
                "resultReuseEnabled": false,
                "resultReuseMaxAgeInMinutes": 60
              },
              "datasource": {
                "type": "grafana-athena-datasource",
                "uid": "${DS_GRAFANA-DASHBOARDS-ATHENA}"
              },
              "format": 1,
              "hide": false,
              "rawSQL": "SELECT \nDATE_TRUNC('${CURGranularity}', line_item_usage_start_date) as line_item_usage_start_date,\nSUM(CASE\n    WHEN line_item_line_item_type = 'DiscountedUsage' THEN reservation_effective_cost\n    ELSE 0 \n  END) AS reserved_instance_spend\nFROM ${CURDatabase}.${CURTable}\nWHERE \n$__timeFilter(line_item_usage_start_date)\nAND line_item_product_code = 'AmazonEC2' \nAND line_item_operation LIKE '%RunInstances%' \nAND line_item_usage_type NOT LIKE '%DataXfer%' \nAND product_servicecode <> 'AWSDataTransfer' \nAND line_item_resource_id NOT LIKE 'arn:%:capacity-reservation/%'\nAND line_item_line_item_type in ('SavingsPlanCoveredUsage', 'Usage', 'DiscountedUsage')\nAND line_item_usage_account_id = '${AccountId}'\nAND product_region_code = '${Region}'\nGROUP BY\nDATE_TRUNC('${CURGranularity}', line_item_usage_start_date)\nORDER BY\nline_item_usage_start_date DESC\n",
              "refId": "ReservedInstance"
            },
            {
              "connectionArgs": {
                "catalog": "__default",
                "database": "__default",
                "region": "__default",
                "resultReuseEnabled": false,
                "resultReuseMaxAgeInMinutes": 60
              },
              "datasource": {
                "type": "grafana-athena-datasource",
                "uid": "${DS_GRAFANA-DASHBOARDS-ATHENA}"
              },
              "format": 1,
              "hide": false,
              "rawSQL": "SELECT \nDATE_TRUNC('${CURGranularity}', line_item_usage_start_date) as line_item_usage_start_date,\nSUM(CASE\n    WHEN line_item_line_item_type = 'Usage' THEN line_item_unblended_cost\n    ELSE 0 \n  END) AS ondemand_spend\nFROM ${CURDatabase}.${CURTable}\nWHERE \n$__timeFilter(line_item_usage_start_date)\nAND line_item_product_code = 'AmazonEC2' \nAND line_item_operation LIKE '%RunInstances%' \nAND line_item_usage_type NOT LIKE '%DataXfer%' \nAND product_servicecode <> 'AWSDataTransfer' \nAND line_item_resource_id NOT LIKE 'arn:%:capacity-reservation/%'\nAND line_item_line_item_type in ('SavingsPlanCoveredUsage', 'Usage', 'DiscountedUsage')\nAND line_item_usage_account_id = '${AccountId}'\nAND product_region_code = '${Region}'\nGROUP BY\nDATE_TRUNC('${CURGranularity}', line_item_usage_start_date)\nORDER BY\nline_item_usage_start_date DESC\n",
              "refId": "OnDemand"
            }
          ],
          "title": "EC2 Compute cost by purchase type for ${AccountId} in ${Region}",
          "transparent": true,
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
          },
          "description": "Top 10 instance types",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "dark-green",
                "mode": "shades"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "Amortized Cost",
                "axisPlacement": "auto",
                "axisSoftMin": 5,
                "fillOpacity": 80,
                "gradientMode": "opacity",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineWidth": 1,
                "scaleDistribution": {
                  "type": "linear"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "displayName": "Instance Types",
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green"
                  }
                ]
              },
              "unit": "currencyUSD"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 19
          },
          "id": 14,
          "options": {
            "barRadius": 0,
            "barWidth": 0.97,
            "fullHighlight": false,
            "groupWidth": 0.7,
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "orientation": "auto",
            "showValue": "auto",
            "stacking": "none",
            "tooltip": {
              "mode": "multi",
              "sort": "none"
            },
            "xTickLabelRotation": 0,
            "xTickLabelSpacing": 0
          },
          "pluginVersion": "10.4.1",
          "targets": [
            {
              "connectionArgs": {
                "catalog": "__default",
                "database": "__default",
                "region": "__default",
                "resultReuseEnabled": false,
                "resultReuseMaxAgeInMinutes": 60
              },
              "datasource": {
                "type": "grafana-athena-datasource",
                "uid": "${DS_GRAFANA-DASHBOARDS-ATHENA}"
              },
              "format": 1,
              "hide": false,
              "rawSQL": "SELECT \nproduct_instance_type,\nSUM(CASE\n    WHEN line_item_line_item_type = 'SavingsPlanCoveredUsage' THEN savings_plan_savings_plan_effective_cost\n    WHEN line_item_line_item_type = 'DiscountedUsage' THEN reservation_effective_cost\n    WHEN line_item_line_item_type = 'Usage' THEN line_item_unblended_cost\n    ELSE 0 \n  END) AS amortized_cost\nFROM ${CURDatabase}.${CURTable}\nWHERE \n$__timeFilter(line_item_usage_start_date)\nAND line_item_product_code = 'AmazonEC2' \nAND line_item_operation LIKE '%RunInstances%' \nAND line_item_usage_type NOT LIKE '%DataXfer%' \nAND product_servicecode <> 'AWSDataTransfer' \nAND line_item_resource_id NOT LIKE 'arn:%:capacity-reservation/%'\nAND line_item_line_item_type in ('SavingsPlanCoveredUsage', 'Usage', 'DiscountedUsage')\nAND line_item_usage_account_id = '${AccountId}'\nAND product_region_code = '${Region}'\nGROUP BY\nproduct_instance_type\nORDER BY \namortized_cost DESC\nLIMIT 10;\n",
              "refId": "InstanceTypes"
            }
          ],
          "title": "Comput Spend by Instance Type in  ${AccountId} in ${Region}",
          "transparent": true,
          "type": "barchart"
        },
        {
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "${DS_GRAFANA-DASHBOARDS-ATHENA}"
          },
          "description": "Top 100 Instance by amortized cost for time period",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "custom": {
                "align": "auto",
                "cellOptions": {
                  "type": "auto"
                },
                "filterable": true,
                "inspect": false,
                "minWidth": 50
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green"
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "currencyUSD"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 9,
            "w": 12,
            "x": 0,
            "y": 27
          },
          "id": 26,
          "options": {
            "cellHeight": "sm",
            "footer": {
              "countRows": false,
              "enablePagination": true,
              "fields": "",
              "reducer": [
                "sum"
              ],
              "show": false
            },
            "showHeader": true
          },
          "pluginVersion": "10.4.1",
          "targets": [
            {
              "connectionArgs": {
                "catalog": "__default",
                "database": "__default",
                "region": "__default",
                "resultReuseEnabled": false,
                "resultReuseMaxAgeInMinutes": 60
              },
              "datasource": {
                "type": "grafana-athena-datasource",
                "uid": "${DS_GRAFANA-DASHBOARDS-ATHENA}"
              },
              "format": 1,
              "rawSQL": "SELECT\nline_item_resource_id as instance_id,\nSUM(CASE\n    WHEN line_item_line_item_type = 'SavingsPlanCoveredUsage' THEN savings_plan_savings_plan_effective_cost\n    WHEN line_item_line_item_type = 'DiscountedUsage' THEN reservation_effective_cost\n    WHEN line_item_line_item_type = 'Usage' THEN line_item_unblended_cost\n    ELSE 0 \n  END) AS amortized_cost\nFROM ${CURDatabase}.${CURTable}\nWHERE \n$__timeFilter(line_item_usage_start_date) \nAND line_item_product_code = 'AmazonEC2' \nAND line_item_operation LIKE '%RunInstances%' \nAND line_item_usage_type NOT LIKE '%DataXfer%' \nAND product_servicecode <> 'AWSDataTransfer' \nAND line_item_resource_id NOT LIKE 'arn:%:capacity-reservation/%'\nAND line_item_line_item_type in ('SavingsPlanCoveredUsage', 'Usage', 'DiscountedUsage')\nAND line_item_usage_account_id = '${AccountId}'\nAND product_region_code = '${Region}'\nGROUP BY\nline_item_resource_id\nORDER BY\namortized_cost DESC\nLIMIT 100",
              "refId": "CUR"
            }
          ],
          "title": "Top 100 Instances by Cost",
          "type": "table"
        }
      ],
      "title": "EC2 Compute Overview - ${AccountId} in ${Region}",
      "type": "row"
    },
    {
      "collapsed": true,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 11
      },
      "id": 18,
      "panels": [
        {
          "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
          },
          "description": "Amortized cost for  EC2 Compute ",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "dark-green",
                "mode": "shades",
                "seriesBy": "max"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "series",
                "axisLabel": "Amortized Cost",
                "axisPlacement": "left",
                "axisSoftMin": 5,
                "axisWidth": 75,
                "barAlignment": 0,
                "drawStyle": "line",
                "fillOpacity": 25,
                "gradientMode": "opacity",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "smooth",
                "lineStyle": {
                  "dash": [
                    0,
                    10
                  ],
                  "fill": "dot"
                },
                "lineWidth": 1,
                "pointSize": 2,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "displayName": "Amortized Cost",
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green"
                  }
                ]
              },
              "unit": "currencyUSD"
            },
            "overrides": [
              {
                "matcher": {
                  "id": "byName",
                  "options": "unit_cost"
                },
                "properties": [
                  {
                    "id": "displayName",
                    "value": "unit_cost"
                  },
                  {
                    "id": "color",
                    "value": {
                      "fixedColor": "purple",
                      "mode": "shades"
                    }
                  },
                  {
                    "id": "custom.lineStyle"
                  },
                  {
                    "id": "custom.lineInterpolation",
                    "value": "smooth"
                  },
                  {
                    "id": "custom.fillOpacity",
                    "value": 0
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "count_instances"
                },
                "properties": [
                  {
                    "id": "displayName",
                    "value": "instance_count"
                  },
                  {
                    "id": "color",
                    "value": {
                      "fixedColor": "blue",
                      "mode": "shades"
                    }
                  },
                  {
                    "id": "unit",
                    "value": "none"
                  },
                  {
                    "id": "custom.axisPlacement",
                    "value": "right"
                  },
                  {
                    "id": "custom.axisLabel",
                    "value": "Instance Count"
                  }
                ]
              }
            ]
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 12
          },
          "id": 24,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "mode": "multi",
              "sort": "none"
            }
          },
          "targets": [
            {
              "connectionArgs": {
                "catalog": "__default",
                "database": "__default",
                "region": "__default",
                "resultReuseEnabled": false,
                "resultReuseMaxAgeInMinutes": 60
              },
              "datasource": {
                "type": "grafana-athena-datasource",
                "uid": "${DS_GRAFANA-DASHBOARDS-ATHENA}"
              },
              "format": 1,
              "hide": false,
              "rawSQL": "SELECT \nDATE_TRUNC('${CURGranularity}', line_item_usage_start_date) as line_item_usage_start_date,\nCOUNT(DISTINCT(line_item_resource_id)) as count_instances,\nSUM(CASE\n    WHEN line_item_line_item_type = 'SavingsPlanCoveredUsage' THEN savings_plan_savings_plan_effective_cost\n    WHEN line_item_line_item_type = 'DiscountedUsage' THEN reservation_effective_cost\n    WHEN line_item_line_item_type = 'Usage' THEN line_item_unblended_cost\n    ELSE 0 \n  END) AS amortized_cost\nFROM ${CURDatabase}.${CURTable}\nWHERE \n$__timeFilter(line_item_usage_start_date)\nAND line_item_product_code = 'AmazonEC2' \nAND line_item_operation LIKE '%RunInstances%' \nAND line_item_usage_type NOT LIKE '%DataXfer%' \nAND product_servicecode <> 'AWSDataTransfer' \nAND line_item_resource_id NOT LIKE 'arn:%:capacity-reservation/%'\nAND line_item_line_item_type in ('SavingsPlanCoveredUsage', 'Usage', 'DiscountedUsage')\nAND line_item_usage_account_id = '${AccountId}'\nAND product_region_code = '${Region}'\nAND resource_tags['${TagKey}'] = '${TagValue}'\nGROUP BY\nDATE_TRUNC('${CURGranularity}', line_item_usage_start_date)\nORDER BY\nline_item_usage_start_date DESC\n",
              "refId": "CUR"
            }
          ],
          "title": "EC2 Compute Cost for ${AccountId} in ${Region} -  Tag: (${TagKey}, ${TagValue})",
          "transformations": [
            {
              "id": "calculateField",
              "options": {
                "alias": "unit_cost",
                "binary": {
                  "left": "amortized_cost",
                  "operator": "/",
                  "right": "count_instances"
                },
                "mode": "binary",
                "reduce": {
                  "reducer": "sum"
                },
                "replaceFields": false
              }
            },
            {
              "id": "organize",
              "options": {
                "excludeByName": {
                  "count_instances": false
                },
                "includeByName": {},
                "indexByName": {},
                "renameByName": {}
              }
            }
          ],
          "transparent": true,
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
          },
          "description": "Amortized cost includes EC2 Compute: ${__from:date:iso} - ${__to:date:iso}",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "displayName": "Amortized EC2 Cost for Tag",
              "mappings": [],
              "noValue": "$0",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green"
                  }
                ]
              },
              "unit": "currencyUSD"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 12
          },
          "id": 20,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "10.4.1",
          "targets": [
            {
              "connectionArgs": {
                "catalog": "__default",
                "database": "__default",
                "region": "__default",
                "resultReuseEnabled": false,
                "resultReuseMaxAgeInMinutes": 60
              },
              "datasource": {
                "type": "grafana-athena-datasource",
                "uid": "${DS_GRAFANA-DASHBOARDS-ATHENA}"
              },
              "format": 1,
              "hide": false,
              "rawSQL": "SELECT \nSUM(CASE\n    WHEN line_item_line_item_type = 'SavingsPlanCoveredUsage' THEN savings_plan_savings_plan_effective_cost\n    WHEN line_item_line_item_type = 'DiscountedUsage' THEN reservation_effective_cost\n    WHEN line_item_line_item_type = 'Usage' THEN line_item_unblended_cost\n    ELSE 0 \n  END) AS amortized_cost\nFROM ${CURDatabase}.${CURTable}\nWHERE \n$__timeFilter(line_item_usage_start_date)\nAND line_item_product_code = 'AmazonEC2' \nAND line_item_operation LIKE '%RunInstances%' \nAND line_item_usage_type NOT LIKE '%DataXfer%' \nAND product_servicecode <> 'AWSDataTransfer' \nAND line_item_resource_id NOT LIKE 'arn:%:capacity-reservation/%'\nAND line_item_line_item_type in ('SavingsPlanCoveredUsage', 'Usage', 'DiscountedUsage')\nAND line_item_usage_account_id = '${AccountId}'\nAND product_region_code = '${Region}'\nAND resource_tags['${TagKey}'] = '${TagValue}';\n\n",
              "refId": "CUR"
            }
          ],
          "title": "EC2 Compute Cost for ${AccountId} in ${Region} -  Tag: (${TagKey}, ${TagValue})",
          "transparent": true,
          "type": "stat"
        },
        {
          "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
          },
          "description": "Amortized cost for  EC2 Compute ",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "dark-green",
                "mode": "shades",
                "seriesBy": "max"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "series",
                "axisLabel": "Amortized Cost",
                "axisPlacement": "left",
                "axisSoftMin": 5,
                "axisWidth": 75,
                "barAlignment": 0,
                "drawStyle": "line",
                "fillOpacity": 25,
                "gradientMode": "opacity",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "smooth",
                "lineStyle": {
                  "dash": [
                    0,
                    10
                  ],
                  "fill": "dot"
                },
                "lineWidth": 1,
                "pointSize": 2,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "displayName": "Savings Plan Spend",
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green"
                  }
                ]
              },
              "unit": "currencyUSD"
            },
            "overrides": [
              {
                "matcher": {
                  "id": "byFrameRefID",
                  "options": "ReservedInstance"
                },
                "properties": [
                  {
                    "id": "color",
                    "value": {
                      "fixedColor": "dark-orange",
                      "mode": "shades"
                    }
                  },
                  {
                    "id": "custom.axisColorMode",
                    "value": "text"
                  },
                  {
                    "id": "displayName",
                    "value": "Reserved Instance Spend"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byFrameRefID",
                  "options": "OnDemand"
                },
                "properties": [
                  {
                    "id": "displayName",
                    "value": "OnDemand"
                  },
                  {
                    "id": "color",
                    "value": {
                      "fixedColor": "dark-purple",
                      "mode": "shades"
                    }
                  }
                ]
              }
            ]
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 20
          },
          "id": 21,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "mode": "multi",
              "sort": "none"
            }
          },
          "targets": [
            {
              "connectionArgs": {
                "catalog": "__default",
                "database": "__default",
                "region": "__default",
                "resultReuseEnabled": false,
                "resultReuseMaxAgeInMinutes": 60
              },
              "datasource": {
                "type": "grafana-athena-datasource",
                "uid": "${DS_GRAFANA-DASHBOARDS-ATHENA}"
              },
              "format": 1,
              "hide": false,
              "rawSQL": "SELECT \nDATE_TRUNC('${CURGranularity}', line_item_usage_start_date) as line_item_usage_start_date,\nSUM(CASE\n    WHEN line_item_line_item_type = 'SavingsPlanCoveredUsage' THEN savings_plan_savings_plan_effective_cost\n    ELSE 0 \n  END) AS savings_plan_spend\nFROM ${CURDatabase}.${CURTable}\nWHERE \n$__timeFilter(line_item_usage_start_date)\nAND line_item_product_code = 'AmazonEC2' \nAND line_item_operation LIKE '%RunInstances%' \nAND line_item_usage_type NOT LIKE '%DataXfer%' \nAND product_servicecode <> 'AWSDataTransfer' \nAND line_item_resource_id NOT LIKE 'arn:%:capacity-reservation/%'\nAND line_item_line_item_type in ('SavingsPlanCoveredUsage', 'Usage', 'DiscountedUsage')\nAND line_item_usage_account_id = '${AccountId}'\nAND product_region_code = '${Region}'\nAND resource_tags['${TagKey}'] = '${TagValue}'\nGROUP BY\nDATE_TRUNC('${CURGranularity}', line_item_usage_start_date)\nORDER BY\nline_item_usage_start_date DESC\n",
              "refId": "SavingsPlan"
            },
            {
              "connectionArgs": {
                "catalog": "__default",
                "database": "__default",
                "region": "__default",
                "resultReuseEnabled": false,
                "resultReuseMaxAgeInMinutes": 60
              },
              "datasource": {
                "type": "grafana-athena-datasource",
                "uid": "${DS_GRAFANA-DASHBOARDS-ATHENA}"
              },
              "format": 1,
              "hide": false,
              "rawSQL": "SELECT \nDATE_TRUNC('${CURGranularity}', line_item_usage_start_date) as line_item_usage_start_date,\nSUM(CASE\n    WHEN line_item_line_item_type = 'DiscountedUsage' THEN reservation_effective_cost\n    ELSE 0 \n  END) AS reserved_instance_spend\nFROM ${CURDatabase}.${CURTable}\nWHERE \n$__timeFilter(line_item_usage_start_date)\nAND line_item_product_code = 'AmazonEC2'\nAND line_item_operation = 'RunInstances'\nAND line_item_usage_type LIKE '%Box%'\nAND line_item_line_item_type in ('SavingsPlanCoveredUsage', 'Usage', 'DiscountedUsage')\nAND line_item_usage_account_id = '${AccountId}'\nAND product_region_code = '${Region}'\nAND resource_tags['${TagKey}'] = '${TagValue}'\nGROUP BY\nDATE_TRUNC('${CURGranularity}', line_item_usage_start_date)\nORDER BY\nline_item_usage_start_date DESC\n",
              "refId": "ReservedInstance"
            },
            {
              "connectionArgs": {
                "catalog": "__default",
                "database": "__default",
                "region": "__default",
                "resultReuseEnabled": false,
                "resultReuseMaxAgeInMinutes": 60
              },
              "datasource": {
                "type": "grafana-athena-datasource",
                "uid": "${DS_GRAFANA-DASHBOARDS-ATHENA}"
              },
              "format": 1,
              "hide": false,
              "rawSQL": "SELECT \nDATE_TRUNC('${CURGranularity}', line_item_usage_start_date) as line_item_usage_start_date,\nSUM(CASE\n    WHEN line_item_line_item_type = 'Usage' THEN line_item_unblended_cost\n    ELSE 0 \n  END) AS ondemand_spend\nFROM ${CURDatabase}.${CURTable}\nWHERE \n$__timeFilter(line_item_usage_start_date)\nAND line_item_product_code = 'AmazonEC2'\nAND line_item_operation = 'RunInstances'\nAND line_item_usage_type LIKE '%Box%'\nAND line_item_line_item_type in ('SavingsPlanCoveredUsage', 'Usage', 'DiscountedUsage')\nAND line_item_usage_account_id = '${AccountId}'\nAND product_region_code = '${Region}'\nAND resource_tags['${TagKey}'] = '${TagValue}'\nGROUP BY\nDATE_TRUNC('${CURGranularity}', line_item_usage_start_date)\nORDER BY\nline_item_usage_start_date DESC\n",
              "refId": "OnDemand"
            }
          ],
          "title": "EC2 Compute cost by purchase type for ${AccountId} in ${Region} -  Tag: (${TagKey}, ${TagValue})",
          "transparent": true,
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
          },
          "description": "Top 10 instance types - ${__from:date:iso} - ${__to:date:iso}\n",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "dark-green",
                "mode": "shades"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "Amortized Cost",
                "axisPlacement": "auto",
                "axisSoftMin": 5,
                "fillOpacity": 80,
                "gradientMode": "opacity",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineWidth": 1,
                "scaleDistribution": {
                  "type": "linear"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "displayName": "Instance Types",
              "mappings": [],
              "noValue": "No data for tag",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green"
                  }
                ]
              },
              "unit": "currencyUSD"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 20
          },
          "id": 22,
          "options": {
            "barRadius": 0,
            "barWidth": 0.97,
            "fullHighlight": false,
            "groupWidth": 0.7,
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "orientation": "auto",
            "showValue": "auto",
            "stacking": "none",
            "tooltip": {
              "mode": "multi",
              "sort": "none"
            },
            "xTickLabelRotation": 0,
            "xTickLabelSpacing": 0
          },
          "pluginVersion": "10.4.1",
          "targets": [
            {
              "connectionArgs": {
                "catalog": "__default",
                "database": "__default",
                "region": "__default",
                "resultReuseEnabled": false,
                "resultReuseMaxAgeInMinutes": 60
              },
              "datasource": {
                "type": "grafana-athena-datasource",
                "uid": "${DS_GRAFANA-DASHBOARDS-ATHENA}"
              },
              "format": 1,
              "hide": false,
              "rawSQL": "SELECT \nproduct_instance_type,\nSUM(CASE\n    WHEN line_item_line_item_type = 'SavingsPlanCoveredUsage' THEN savings_plan_savings_plan_effective_cost\n    WHEN line_item_line_item_type = 'DiscountedUsage' THEN reservation_effective_cost\n    WHEN line_item_line_item_type = 'Usage' THEN line_item_unblended_cost\n    ELSE 0 \n  END) AS amortized_cost\nFROM ${CURDatabase}.${CURTable}\nWHERE \n$__timeFilter(line_item_usage_start_date)\nAND line_item_product_code = 'AmazonEC2' \nAND line_item_operation LIKE '%RunInstances%' \nAND line_item_usage_type NOT LIKE '%DataXfer%' \nAND product_servicecode <> 'AWSDataTransfer' \nAND line_item_resource_id NOT LIKE 'arn:%:capacity-reservation/%'\nAND line_item_line_item_type in ('SavingsPlanCoveredUsage', 'Usage', 'DiscountedUsage')\nAND line_item_usage_account_id = '${AccountId}'\nAND product_region_code = '${Region}'\nAND resource_tags['${TagKey}'] = '${TagValue}'\nGROUP BY\nproduct_instance_type\nORDER BY \namortized_cost DESC\nLIMIT 10;\n",
              "refId": "InstanceTypes"
            }
          ],
          "title": "Comput Spend by Instance Type in  ${AccountId} in ${Region} - Tag: (${TagKey}, ${TagValue})",
          "transparent": true,
          "type": "barchart"
        },
        {
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "${DS_GRAFANA-DASHBOARDS-ATHENA}"
          },
          "description": "Top 100 Instance by amortized cost for time period",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "custom": {
                "align": "auto",
                "cellOptions": {
                  "type": "auto"
                },
                "filterable": true,
                "inspect": false,
                "minWidth": 50
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green"
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "currencyUSD"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 9,
            "w": 12,
            "x": 0,
            "y": 28
          },
          "id": 25,
          "options": {
            "cellHeight": "sm",
            "footer": {
              "countRows": false,
              "enablePagination": true,
              "fields": "",
              "reducer": [
                "sum"
              ],
              "show": false
            },
            "showHeader": true
          },
          "pluginVersion": "10.4.1",
          "targets": [
            {
              "connectionArgs": {
                "catalog": "__default",
                "database": "__default",
                "region": "__default",
                "resultReuseEnabled": false,
                "resultReuseMaxAgeInMinutes": 60
              },
              "datasource": {
                "type": "grafana-athena-datasource",
                "uid": "${DS_GRAFANA-DASHBOARDS-ATHENA}"
              },
              "format": 1,
              "rawSQL": "SELECT\nline_item_resource_id as instance_id,\nSUM(CASE\n    WHEN line_item_line_item_type = 'SavingsPlanCoveredUsage' THEN savings_plan_savings_plan_effective_cost\n    WHEN line_item_line_item_type = 'DiscountedUsage' THEN reservation_effective_cost\n    WHEN line_item_line_item_type = 'Usage' THEN line_item_unblended_cost\n    ELSE 0 \n  END) AS amortized_cost\nFROM ${CURDatabase}.${CURTable}\nWHERE \n$__timeFilter(line_item_usage_start_date) \nAND line_item_product_code = 'AmazonEC2' \nAND line_item_operation LIKE '%RunInstances%' \nAND line_item_usage_type NOT LIKE '%DataXfer%' \nAND product_servicecode <> 'AWSDataTransfer' \nAND line_item_resource_id NOT LIKE 'arn:%:capacity-reservation/%'\nAND line_item_line_item_type in ('SavingsPlanCoveredUsage', 'Usage', 'DiscountedUsage')\nAND line_item_usage_account_id = '${AccountId}'\nAND product_region_code = '${Region}'\nAND resource_tags['${TagKey}'] = '${TagValue}'\nGROUP BY\nline_item_resource_id\nORDER BY\namortized_cost DESC\nLIMIT 100",
              "refId": "CUR"
            }
          ],
          "title": "Top 100 Instances by Cost - Tag: (${TagKey}, ${TagValue})",
          "type": "table"
        }
      ],
      "title": "Tag Explorer",
      "type": "row"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 12
      },
      "id": 10,
      "panels": [],
      "title": "Instance Explorer - ${InstanceId}",
      "type": "row"
    },
    {
      "datasource": {
        "type": "datasource",
        "uid": "-- Mixed --"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "fixedColor": "dark-green",
            "mode": "shades",
            "seriesBy": "max"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "series",
            "axisLabel": "Amortized Cost",
            "axisPlacement": "left",
            "axisSoftMin": 5,
            "axisWidth": 75,
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 25,
            "gradientMode": "opacity",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "smooth",
            "lineStyle": {
              "dash": [
                0,
                10
              ],
              "fill": "dot"
            },
            "lineWidth": 1,
            "pointSize": 2,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "displayName": "Amortized Cost",
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byFrameRefID",
              "options": "CW"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "dark-purple",
                  "mode": "shades",
                  "seriesBy": "max"
                }
              },
              {
                "id": "custom.axisPlacement",
                "value": "right"
              },
              {
                "id": "custom.axisLabel",
                "value": "CPU Percentage"
              },
              {
                "id": "custom.axisSoftMin",
                "value": 5
              },
              {
                "id": "unit",
                "value": "percent"
              },
              {
                "id": "displayName",
                "value": "CPU Percentage"
              },
              {
                "id": "custom.gradientMode",
                "value": "opacity"
              },
              {
                "id": "custom.fillOpacity",
                "value": 50
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 13
      },
      "id": 3,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "multi",
          "sort": "none"
        }
      },
      "targets": [
        {
          "connectionArgs": {
            "catalog": "__default",
            "database": "__default",
            "region": "__default",
            "resultReuseEnabled": false,
            "resultReuseMaxAgeInMinutes": 60
          },
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "${DS_GRAFANA-DASHBOARDS-ATHENA}"
          },
          "format": 1,
          "hide": false,
          "rawSQL": "SELECT \nDATE_TRUNC('${CURGranularity}', line_item_usage_start_date) as line_item_usage_start_date,\nSUM(CASE\n    WHEN line_item_line_item_type = 'SavingsPlanCoveredUsage' THEN savings_plan_savings_plan_effective_cost\n    WHEN line_item_line_item_type = 'DiscountedUsage' THEN reservation_effective_cost\n    WHEN line_item_line_item_type = 'Usage' THEN line_item_unblended_cost\n    ELSE 0 \n  END) AS amortized_cost\nFROM ${CURDatabase}.${CURTable}\nWHERE \n$__timeFilter(line_item_usage_start_date)\nAND line_item_product_code = 'AmazonEC2' \nAND line_item_operation LIKE '%RunInstances%' \nAND line_item_usage_type NOT LIKE '%DataXfer%' \nAND product_servicecode <> 'AWSDataTransfer' \nAND line_item_resource_id NOT LIKE 'arn:%:capacity-reservation/%'\nAND line_item_line_item_type in ('SavingsPlanCoveredUsage', 'Usage', 'DiscountedUsage')\nAND line_item_usage_account_id = '${AccountId}'\nAND product_region_code = '${Region}'\nAND line_item_resource_id = '${InstanceId}'\nGROUP BY\nDATE_TRUNC('${CURGranularity}', line_item_usage_start_date)\nORDER BY\nline_item_usage_start_date DESC\n",
          "refId": "CUR"
        },
        {
          "datasource": {
            "type": "cloudwatch",
            "uid": "${DS_GRAFANA-DASHBOARDS-CLOUDWATCH}"
          },
          "dimensions": {},
          "expression": "REMOVE_EMPTY(SEARCH('{\"AWS/EC2\",\"InstanceId\"} MetricName=\"CPUUtilization\" InstanceId=\"${InstanceId}\" :aws.AccountId=\"${AccountId}\"', 'Average', ${CWGranularity}))",
          "hide": false,
          "id": "",
          "label": "",
          "logGroups": [],
          "matchExact": true,
          "metricEditorMode": 1,
          "metricName": "",
          "metricQueryType": 0,
          "namespace": "",
          "period": "",
          "queryMode": "Metrics",
          "refId": "CW",
          "region": "$Region",
          "sqlExpression": "",
          "statistic": "Average"
        }
      ],
      "title": "CPU over Cost - ${InstanceId}",
      "transparent": true,
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "datasource",
        "uid": "-- Mixed --"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "fixedColor": "semi-dark-green",
            "mode": "shades"
          },
          "displayName": "Instance Type",
          "mappings": [],
          "noValue": "No value",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 6,
        "x": 12,
        "y": 13
      },
      "id": 16,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [],
          "fields": "/.*/",
          "values": true
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "10.4.1",
      "targets": [
        {
          "connectionArgs": {
            "catalog": "__default",
            "database": "__default",
            "region": "__default",
            "resultReuseEnabled": false,
            "resultReuseMaxAgeInMinutes": 60
          },
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "${DS_GRAFANA-DASHBOARDS-ATHENA}"
          },
          "format": 1,
          "hide": false,
          "rawSQL": "SELECT \nproduct_instance_type\nFROM ${CURDatabase}.${CURTable}\nWHERE \n$__timeFilter(line_item_usage_start_date)\nAND line_item_product_code = 'AmazonEC2' \nAND line_item_operation LIKE '%RunInstances%' \nAND line_item_usage_type NOT LIKE '%DataXfer%' \nAND product_servicecode <> 'AWSDataTransfer' \nAND line_item_resource_id NOT LIKE 'arn:%:capacity-reservation/%'\nAND line_item_line_item_type in ('SavingsPlanCoveredUsage', 'Usage', 'DiscountedUsage')\nAND line_item_usage_account_id = '${AccountId}'\nAND product_region_code = '${Region}'\nAND line_item_resource_id = '${InstanceId}'\nGROUP BY\nproduct_instance_type\n\n",
          "refId": "CUR"
        }
      ],
      "title": "Instance Types",
      "transparent": true,
      "type": "stat"
    },
    {
      "datasource": {
        "type": "datasource",
        "uid": "-- Mixed --"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "fixedColor": "semi-dark-green",
            "mode": "shades"
          },
          "displayName": "${InstanceId}",
          "mappings": [],
          "noValue": "No value",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 6,
        "x": 18,
        "y": 13
      },
      "id": 17,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [],
          "fields": "/.*/",
          "values": true
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "10.4.1",
      "targets": [
        {
          "connectionArgs": {
            "catalog": "__default",
            "database": "__default",
            "region": "__default",
            "resultReuseEnabled": false,
            "resultReuseMaxAgeInMinutes": 60
          },
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "${DS_GRAFANA-DASHBOARDS-ATHENA}"
          },
          "format": 1,
          "hide": false,
          "rawSQL": "\nSELECT \n  DISTINCT\n  CASE\n    WHEN line_item_line_item_type = 'SavingsPlanCoveredUsage' THEN 'Savings Plan'\n    WHEN line_item_line_item_type = 'DiscountedUsage' THEN 'Reserved Instance'\n    WHEN line_item_line_item_type = 'Usage' THEN 'On Demand'\n    ELSE 'Other'\n  END\nFROM \n  ${CURDatabase}.${CURTable}\nWHERE \n$__timeFilter(line_item_usage_start_date)\nAND line_item_product_code = 'AmazonEC2' \nAND line_item_operation LIKE '%RunInstances%' \nAND line_item_usage_type NOT LIKE '%DataXfer%' \nAND product_servicecode <> 'AWSDataTransfer' \nAND line_item_resource_id NOT LIKE 'arn:%:capacity-reservation/%'\nAND line_item_line_item_type in ('SavingsPlanCoveredUsage', 'Usage', 'DiscountedUsage')\nAND line_item_usage_account_id = '${AccountId}'\nAND product_region_code = '${Region}'\nAND line_item_resource_id = '${InstanceId}'\n",
          "refId": "CUR"
        }
      ],
      "title": "Instance Purchase Types",
      "transparent": true,
      "type": "stat"
    },
    {
      "datasource": {
        "type": "datasource",
        "uid": "-- Mixed --"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "fixedColor": "dark-green",
            "mode": "shades",
            "seriesBy": "max"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "series",
            "axisLabel": "Usage Amount",
            "axisPlacement": "left",
            "axisSoftMin": 5,
            "axisWidth": 50,
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 25,
            "gradientMode": "opacity",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "smooth",
            "lineStyle": {
              "dash": [
                0,
                10
              ],
              "fill": "dot"
            },
            "lineWidth": 1,
            "pointSize": 2,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "displayName": "Usage Amount",
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          },
          "unit": "none"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byFrameRefID",
              "options": "CW"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "dark-purple",
                  "mode": "shades",
                  "seriesBy": "max"
                }
              },
              {
                "id": "custom.axisPlacement",
                "value": "right"
              },
              {
                "id": "custom.axisLabel",
                "value": "CPU Percentage"
              },
              {
                "id": "custom.axisSoftMin",
                "value": 5
              },
              {
                "id": "unit",
                "value": "percent"
              },
              {
                "id": "displayName",
                "value": "CPU Percentage"
              },
              {
                "id": "custom.gradientMode",
                "value": "opacity"
              },
              {
                "id": "custom.fillOpacity",
                "value": 50
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 21
      },
      "id": 5,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "multi",
          "sort": "none"
        }
      },
      "targets": [
        {
          "connectionArgs": {
            "catalog": "__default",
            "database": "__default",
            "region": "__default",
            "resultReuseEnabled": false,
            "resultReuseMaxAgeInMinutes": 60
          },
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "${DS_GRAFANA-DASHBOARDS-ATHENA}"
          },
          "format": 1,
          "hide": false,
          "rawSQL": "SELECT \nDATE_TRUNC('${CURGranularity}', line_item_usage_start_date) as line_item_usage_start_date,\nSUM(line_item_usage_amount) as sum_line_item_usage_amount\nFROM ${CURDatabase}.${CURTable}\nWHERE \n$__timeFilter(line_item_usage_start_date)\nAND line_item_product_code = 'AmazonEC2' \nAND line_item_operation LIKE '%RunInstances%' \nAND line_item_usage_type NOT LIKE '%DataXfer%' \nAND product_servicecode <> 'AWSDataTransfer' \nAND line_item_resource_id NOT LIKE 'arn:%:capacity-reservation/%'\nAND line_item_line_item_type in ('SavingsPlanCoveredUsage', 'Usage', 'DiscountedUsage')\nAND line_item_usage_account_id = '${AccountId}'\nAND product_region_code = '${Region}'\nAND line_item_resource_id = '${InstanceId}'\nGROUP BY\nline_item_usage_start_date\nORDER BY\nline_item_usage_start_date DESC\n",
          "refId": "CUR"
        },
        {
          "datasource": {
            "type": "cloudwatch",
            "uid": "${DS_GRAFANA-DASHBOARDS-CLOUDWATCH}"
          },
          "dimensions": {},
          "expression": "REMOVE_EMPTY(SEARCH('{\"AWS/EC2\",\"InstanceId\"} \"CPUUtilization\" InstanceId=\"${InstanceId}\" :aws.AccountId=\"${AccountId}\"', 'Average', ${CWGranularity}))",
          "hide": false,
          "id": "",
          "label": "",
          "logGroups": [],
          "matchExact": true,
          "metricEditorMode": 1,
          "metricName": "",
          "metricQueryType": 0,
          "namespace": "",
          "period": "",
          "queryMode": "Metrics",
          "refId": "CW",
          "region": "us-east-1",
          "sqlExpression": "",
          "statistic": "Average"
        }
      ],
      "title": "CPU over Usage -  ${InstanceId}",
      "transparent": true,
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "datasource",
        "uid": "-- Mixed --"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "fixedColor": "dark-green",
            "mode": "shades",
            "seriesBy": "max"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "series",
            "axisLabel": "Network Cost",
            "axisPlacement": "left",
            "axisSoftMin": 0,
            "axisWidth": 75,
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 25,
            "gradientMode": "opacity",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "smooth",
            "lineStyle": {
              "dash": [
                0,
                10
              ],
              "fill": "dot"
            },
            "lineWidth": 1,
            "pointSize": 2,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "displayName": "Network Cost",
          "mappings": [],
          "min": 0,
          "noValue": "No Value",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byFrameRefID",
              "options": "CW"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "dark-purple",
                  "mode": "shades",
                  "seriesBy": "max"
                }
              },
              {
                "id": "custom.axisPlacement",
                "value": "right"
              },
              {
                "id": "custom.axisLabel",
                "value": "CPU Percentage"
              },
              {
                "id": "custom.axisSoftMin",
                "value": 10
              },
              {
                "id": "unit",
                "value": "bytes"
              },
              {
                "id": "displayName",
                "value": "Network Out (Bytes)"
              },
              {
                "id": "custom.gradientMode",
                "value": "opacity"
              },
              {
                "id": "custom.fillOpacity",
                "value": 50
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 21
      },
      "id": 7,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "multi",
          "sort": "none"
        }
      },
      "targets": [
        {
          "connectionArgs": {
            "catalog": "__default",
            "database": "__default",
            "region": "__default",
            "resultReuseEnabled": false,
            "resultReuseMaxAgeInMinutes": 60
          },
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "${DS_GRAFANA-DASHBOARDS-ATHENA}"
          },
          "format": 1,
          "hide": false,
          "rawSQL": "SELECT \nDATE_TRUNC('${CURGranularity}', line_item_usage_start_date) as line_item_usage_start_date,\nSUM(line_item_unblended_cost) as sum_line_item_unblended_cost\nFROM ${CURDatabase}.${CURTable}\nWHERE \n$__timeFilter(line_item_usage_start_date)\nAND line_item_product_code = 'AmazonEC2'\nAND line_item_usage_type LIKE '%DataTransfer-Out-Bytes'\nAND line_item_line_item_type in ('SavingsPlanCoveredUsage', 'Usage', 'DiscountedUsage')\nAND line_item_usage_account_id = '${AccountId}'\nAND product_region_code = '${Region}'\nAND line_item_resource_id = '${InstanceId}'\nGROUP BY\nDATE_TRUNC('${CURGranularity}', line_item_usage_start_date)\nORDER BY\nline_item_usage_start_date DESC\n",
          "refId": "CUR"
        },
        {
          "datasource": {
            "type": "cloudwatch",
            "uid": "${DS_GRAFANA-DASHBOARDS-CLOUDWATCH}"
          },
          "dimensions": {},
          "expression": "REMOVE_EMPTY(SEARCH('{\"AWS/EC2\",\"InstanceId\"} \"NetworkOut\" InstanceId=\"${InstanceId}\" :aws.AccountId=\"${AccountId}\"', 'Average', ${CWGranularity}))",
          "hide": false,
          "id": "",
          "label": "",
          "logGroups": [],
          "matchExact": true,
          "metricEditorMode": 1,
          "metricName": "",
          "metricQueryType": 0,
          "namespace": "",
          "period": "",
          "queryMode": "Metrics",
          "refId": "CW",
          "region": "us-east-1",
          "sqlExpression": "",
          "statistic": "Average"
        }
      ],
      "title": "Network Out over Data Transfer Out Cost - ${InstanceId}",
      "transparent": true,
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "datasource",
        "uid": "-- Mixed --"
      },
      "description": "Absence of cost may mean the instance is in the free teir",
      "fieldConfig": {
        "defaults": {
          "color": {
            "fixedColor": "dark-green",
            "mode": "shades",
            "seriesBy": "max"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "series",
            "axisLabel": "Network Cost",
            "axisPlacement": "left",
            "axisSoftMin": 0,
            "axisWidth": 75,
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 25,
            "gradientMode": "opacity",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "smooth",
            "lineStyle": {
              "dash": [
                0,
                10
              ],
              "fill": "dot"
            },
            "lineWidth": 1,
            "pointSize": 2,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "displayName": "Network Cost",
          "mappings": [],
          "min": 0,
          "noValue": "No Value",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byFrameRefID",
              "options": "CW"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "dark-purple",
                  "mode": "shades",
                  "seriesBy": "max"
                }
              },
              {
                "id": "custom.axisPlacement",
                "value": "right"
              },
              {
                "id": "custom.axisLabel",
                "value": "CPU Percentage"
              },
              {
                "id": "custom.axisSoftMin",
                "value": 10
              },
              {
                "id": "unit",
                "value": "bytes"
              },
              {
                "id": "displayName",
                "value": "Network Out (Bytes)"
              },
              {
                "id": "custom.gradientMode",
                "value": "opacity"
              },
              {
                "id": "custom.fillOpacity",
                "value": 50
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 29
      },
      "id": 6,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "multi",
          "sort": "none"
        }
      },
      "targets": [
        {
          "connectionArgs": {
            "catalog": "__default",
            "database": "__default",
            "region": "__default",
            "resultReuseEnabled": false,
            "resultReuseMaxAgeInMinutes": 60
          },
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "${DS_GRAFANA-DASHBOARDS-ATHENA}"
          },
          "format": 1,
          "hide": false,
          "rawSQL": "SELECT \nDATE_TRUNC('${CURGranularity}', line_item_usage_start_date) as line_item_usage_start_date,\nSUM(line_item_unblended_cost) as sum_line_item_unblended_cost\nFROM ${CURDatabase}.${CURTable}\nWHERE \n$__timeFilter(line_item_usage_start_date)\nAND line_item_product_code = 'AmazonEC2'\nAND line_item_usage_type LIKE '%DataTransfer-Regional-Bytes'\nAND line_item_line_item_type in ('SavingsPlanCoveredUsage', 'Usage', 'DiscountedUsage')\nAND line_item_usage_account_id = '${AccountId}'\nAND product_region_code = '${Region}'\nAND line_item_resource_id = '${InstanceId}'\nGROUP BY\nDATE_TRUNC('${CURGranularity}', line_item_usage_start_date)\nORDER BY\nline_item_usage_start_date DESC\n",
          "refId": "CUR"
        },
        {
          "datasource": {
            "type": "cloudwatch",
            "uid": "${DS_GRAFANA-DASHBOARDS-CLOUDWATCH}"
          },
          "dimensions": {},
          "expression": "REMOVE_EMPTY(SEARCH('{\"AWS/EC2\",\"InstanceId\"} \"NetworkOut\" InstanceId=\"${InstanceId}\" :aws.AccountId=\"${AccountId}\"', 'Average', ${CWGranularity}))",
          "hide": false,
          "id": "",
          "label": "",
          "logGroups": [],
          "matchExact": true,
          "metricEditorMode": 1,
          "metricName": "",
          "metricQueryType": 0,
          "namespace": "",
          "period": "",
          "queryMode": "Metrics",
          "refId": "CW",
          "region": "us-east-1",
          "sqlExpression": "",
          "statistic": "Average"
        }
      ],
      "title": "Network Out over Data Transfer Regional  Cost - ${InstanceId}",
      "transparent": true,
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "datasource",
        "uid": "-- Mixed --"
      },
      "description": "Transfer between regions from resource.  Absence of cost may mean the instance is covered under the free tier.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "fixedColor": "dark-green",
            "mode": "shades",
            "seriesBy": "max"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "series",
            "axisLabel": "Network Cost",
            "axisPlacement": "left",
            "axisSoftMin": 0,
            "axisWidth": 75,
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 25,
            "gradientMode": "opacity",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "smooth",
            "lineStyle": {
              "dash": [
                0,
                10
              ],
              "fill": "dot"
            },
            "lineWidth": 1,
            "pointSize": 2,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "displayName": "Network Cost",
          "mappings": [],
          "min": 0,
          "noValue": "No Value",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byFrameRefID",
              "options": "CW"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "dark-purple",
                  "mode": "shades",
                  "seriesBy": "max"
                }
              },
              {
                "id": "custom.axisPlacement",
                "value": "right"
              },
              {
                "id": "custom.axisLabel",
                "value": "CPU Percentage"
              },
              {
                "id": "custom.axisSoftMin",
                "value": 10
              },
              {
                "id": "unit",
                "value": "bytes"
              },
              {
                "id": "displayName",
                "value": "Network Out (Bytes)"
              },
              {
                "id": "custom.gradientMode",
                "value": "opacity"
              },
              {
                "id": "custom.fillOpacity",
                "value": 50
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 29
      },
      "id": 9,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "multi",
          "sort": "none"
        }
      },
      "targets": [
        {
          "connectionArgs": {
            "catalog": "__default",
            "database": "__default",
            "region": "__default",
            "resultReuseEnabled": false,
            "resultReuseMaxAgeInMinutes": 60
          },
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "${DS_GRAFANA-DASHBOARDS-ATHENA}"
          },
          "format": 1,
          "hide": false,
          "rawSQL": "SELECT \nDATE_TRUNC('${CURGranularity}', line_item_usage_start_date) as line_item_usage_start_date,\nSUM(line_item_unblended_cost) as sum_line_item_unblended_cost\nFROM ${CURDatabase}.${CURTable}\nWHERE \n$__timeFilter(line_item_usage_start_date)\nAND line_item_product_code = 'AmazonEC2'\nAND line_item_usage_type LIKE '%-AWS-In-Bytes'\nAND line_item_line_item_type in ('SavingsPlanCoveredUsage', 'Usage', 'DiscountedUsage')\nAND line_item_usage_account_id = '${AccountId}'\nAND product_region_code = '${Region}'\nAND line_item_resource_id = '${InstanceId}'\nGROUP BY\nDATE_TRUNC('${CURGranularity}', line_item_usage_start_date)\nORDER BY\nline_item_usage_start_date DESC\n",
          "refId": "CUR"
        },
        {
          "datasource": {
            "type": "cloudwatch",
            "uid": "${DS_GRAFANA-DASHBOARDS-CLOUDWATCH}"
          },
          "dimensions": {},
          "expression": "REMOVE_EMPTY(SEARCH('{\"AWS/EC2\",\"InstanceId\"} \"NetworkOut\" InstanceId=\"${InstanceId}\" :aws.AccountId=\"${AccountId}\"', 'Average', ${CWGranularity}))",
          "hide": false,
          "id": "",
          "label": "",
          "logGroups": [],
          "matchExact": true,
          "metricEditorMode": 1,
          "metricName": "",
          "metricQueryType": 0,
          "namespace": "",
          "period": "",
          "queryMode": "Metrics",
          "refId": "CW",
          "region": "us-east-1",
          "sqlExpression": "",
          "statistic": "Average"
        }
      ],
      "title": "Network Out over Intra-Region Data Transfer Cost - ${InstanceId}",
      "transparent": true,
      "type": "timeseries"
    }
  ],
  "refresh": "",
  "schemaVersion": 39,
  "tags": [],
  "templating": {
    "list": [
      {
        "current": {
          "selected": false,
          "text": "grafana-dashboards-athena",
          "value": "ber8a0v9qmhhcc"
        },
        "description": "Athena CUR Table connection for queries to AWS Cost and Usage",
        "hide": 2,
        "includeAll": false,
        "label": "CUR Datasource",
        "multi": false,
        "name": "CURDatasource",
        "options": [],
        "query": "grafana-athena-datasource",
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "type": "datasource"
      },
      {
        "current": {
          "selected": false,
          "text": "grafana-dashboards-cloudwatch",
          "value": "cer8a0l7ryq68e"
        },
        "description": "CloudWatch Datasource, for queries to metrics and logs",
        "hide": 2,
        "includeAll": false,
        "label": "CW Datasource",
        "multi": false,
        "name": "CWDatasource",
        "options": [],
        "query": "cloudwatch",
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "type": "datasource"
      },
      {
        "current": {
          "selected": false,
          "text": "cur2",
          "value": "cur2"
        },
        "description": "CUR Table name; change if not cur2",
        "hide": 2,
        "includeAll": false,
        "label": "CUR Table",
        "multi": false,
        "name": "CURTable",
        "options": [
          {
            "selected": true,
            "text": "cur2",
            "value": "cur2"
          }
        ],
        "query": "cur2",
        "skipUrlSync": false,
        "type": "custom"
      },
      {
        "current": {
          "selected": false,
          "text": "cid_data_export",
          "value": "cid_data_export"
        },
        "description": "CUR Database; change this name ",
        "hide": 2,
        "includeAll": false,
        "label": "CUR Database",
        "multi": false,
        "name": "CURDatabase",
        "options": [
          {
            "selected": true,
            "text": "cid_data_export",
            "value": "cid_data_export"
          }
        ],
        "query": "cid_data_export",
        "skipUrlSync": false,
        "type": "custom"
      },
      {
        "current": {},
        "datasource": {
          "type": "grafana-athena-datasource",
          "uid": "${DS_GRAFANA-DASHBOARDS-ATHENA}"
        },
        "definition": "",
        "description": "All account IDs found in the CUR for look back period.",
        "hide": 0,
        "includeAll": false,
        "label": "Account ID",
        "multi": false,
        "name": "AccountId",
        "options": [],
        "query": {
          "connectionArgs": {
            "catalog": "__default",
            "database": "__default",
            "region": "__default",
            "resultReuseEnabled": false,
            "resultReuseMaxAgeInMinutes": 60
          },
          "format": 1,
          "rawSQL": "SELECT \nDISTINCT line_item_usage_account_id\nFROM ${CURDatabase}.${CURTable}\nWHERE \n$__timeFilter(line_item_usage_start_date);\n"
        },
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "sort": 0,
        "type": "query"
      },
      {
        "current": {},
        "datasource": {
          "type": "grafana-athena-datasource",
          "uid": "${DS_GRAFANA-DASHBOARDS-ATHENA}"
        },
        "definition": "",
        "description": "Regions observed in the CUR over the look back period",
        "hide": 0,
        "includeAll": false,
        "label": "Region",
        "multi": false,
        "name": "Region",
        "options": [],
        "query": {
          "connectionArgs": {
            "catalog": "__default",
            "database": "__default",
            "region": "__default",
            "resultReuseEnabled": false,
            "resultReuseMaxAgeInMinutes": 60
          },
          "format": 1,
          "rawSQL": "SELECT \nDISTINCT product_region_code,\nCASE \n    WHEN product_region_code = 'us-east-1' THEN 0\n    ELSE 1\nEND AS sort_order\nFROM ${CURDatabase}.${CURTable}\nWHERE \n$__timeFilter(line_item_usage_start_date)\nAND line_item_usage_account_id = '${AccountId}'\nAND product_region_code != ''\nORDER BY\nsort_order,\nproduct_region_code"
        },
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "sort": 0,
        "type": "query"
      },
      {
        "current": {},
        "datasource": {
          "type": "grafana-athena-datasource",
          "uid": "${DS_GRAFANA-DASHBOARDS-ATHENA}"
        },
        "definition": "",
        "description": "Instance ID found in the CUR for look back period.",
        "hide": 0,
        "includeAll": false,
        "label": "Instance ID",
        "multi": false,
        "name": "InstanceId",
        "options": [],
        "query": {
          "connectionArgs": {
            "catalog": "__default",
            "database": "__default",
            "region": "__default",
            "resultReuseEnabled": false,
            "resultReuseMaxAgeInMinutes": 60
          },
          "format": 1,
          "rawSQL": "SELECT\nline_item_resource_id as instance_id\nFROM ${CURDatabase}.${CURTable}\nWHERE \n$__timeFilter(line_item_usage_start_date) \nAND line_item_product_code = 'AmazonEC2'\nAND line_item_operation = 'RunInstances'\nAND line_item_usage_type LIKE '%Box%'\nAND line_item_line_item_type in ('SavingsPlanCoveredUsage', 'Usage', 'DiscountedUsage')\nAND line_item_usage_account_id = '${AccountId}'\nAND product_region_code = '${Region}';\n"
        },
        "refresh": 2,
        "regex": "",
        "skipUrlSync": false,
        "sort": 0,
        "type": "query"
      },
      {
        "current": {
          "selected": false,
          "text": "day",
          "value": "day"
        },
        "description": "Select the Granularity for CUR data points",
        "hide": 0,
        "includeAll": false,
        "label": "CUR Granularity",
        "multi": false,
        "name": "CURGranularity",
        "options": [
          {
            "selected": false,
            "text": "hour",
            "value": "hour"
          },
          {
            "selected": true,
            "text": "day",
            "value": "day"
          },
          {
            "selected": false,
            "text": "week",
            "value": "week"
          },
          {
            "selected": false,
            "text": "month",
            "value": "month"
          }
        ],
        "query": "hour,day,week,month",
        "queryValue": "",
        "skipUrlSync": false,
        "type": "custom"
      },
      {
        "current": {
          "selected": false,
          "text": "86400",
          "value": "86400"
        },
        "description": "Select the Granularity for CloudWatch data points in seconds.  \n\n300 = 5 minutes, 3600 = 1 hour, 86400 = 1 day, 604800 = 1 week, 2592000 = 1 month",
        "hide": 0,
        "includeAll": false,
        "label": "CloudWatch Granularity(s)",
        "multi": false,
        "name": "CWGranularity",
        "options": [
          {
            "selected": false,
            "text": "300",
            "value": "300"
          },
          {
            "selected": false,
            "text": "3600",
            "value": "3600"
          },
          {
            "selected": true,
            "text": "86400",
            "value": "86400"
          },
          {
            "selected": false,
            "text": "604800",
            "value": "604800"
          },
          {
            "selected": false,
            "text": "2592000",
            "value": "2592000"
          }
        ],
        "query": "300,3600,86400,604800,2592000",
        "queryValue": "",
        "skipUrlSync": false,
        "type": "custom"
      },
      {
        "current": {},
        "datasource": {
          "type": "grafana-athena-datasource",
          "uid": "${DS_GRAFANA-DASHBOARDS-ATHENA}"
        },
        "definition": "",
        "description": "Tag Key extracted from CUR and observed in the time period selected.",
        "hide": 0,
        "includeAll": false,
        "label": "Tag Key",
        "multi": false,
        "name": "TagKey",
        "options": [],
        "query": {
          "connectionArgs": {
            "catalog": "__default",
            "database": "__default",
            "region": "__default",
            "resultReuseEnabled": false,
            "resultReuseMaxAgeInMinutes": 60
          },
          "format": 1,
          "rawSQL": "WITH all_keys AS (\n  SELECT ARRAY_DISTINCT(ARRAY_AGG(key)) AS unique_keys\n  FROM ${CURDatabase}.${CURTable}\n  CROSS JOIN UNNEST(MAP_KEYS(resource_tags)) AS t(key)\n  WHERE \n  $__timeFilter(line_item_usage_start_date)\n  AND line_item_usage_account_id = '${AccountId}'\n  AND product_region_code = '${Region}'\n)\n\nSELECT key AS unique_key\nFROM all_keys\nCROSS JOIN UNNEST(unique_keys) AS t(key);"
        },
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "sort": 0,
        "type": "query"
      },
      {
        "current": {},
        "datasource": {
          "type": "grafana-athena-datasource",
          "uid": "${DS_GRAFANA-DASHBOARDS-ATHENA}"
        },
        "definition": "",
        "hide": 0,
        "includeAll": false,
        "label": "TagValue",
        "multi": false,
        "name": "TagValue",
        "options": [],
        "query": {
          "connectionArgs": {
            "catalog": "__default",
            "database": "__default",
            "region": "__default",
            "resultReuseEnabled": false,
            "resultReuseMaxAgeInMinutes": 60
          },
          "format": 1,
          "rawSQL": "SELECT \n  resource_tags['${TagKey}'] AS tag_value,\n  COUNT(*) AS count\nFROM ${CURDatabase}.${CURTable}\nWHERE \n  $__timeFilter(line_item_usage_start_date)\n  AND line_item_usage_account_id = '${AccountId}'\n  AND product_region_code = '${Region}'\n  AND resource_tags['${TagKey}'] IS NOT NULL\nGROUP BY resource_tags['${TagKey}']\nORDER BY count DESC;"
        },
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "sort": 0,
        "type": "query"
      },
      {
        "current": {},
        "datasource": {
          "type": "grafana-athena-datasource",
          "uid": "${DS_GRAFANA-DASHBOARDS-ATHENA}"
        },
        "definition": "",
        "description": "Load Balancer Name - tagged with $TagKey $TagValue - observed during selected time period. ",
        "hide": 0,
        "includeAll": false,
        "label": "Load Balancer",
        "multi": false,
        "name": "LBName",
        "options": [],
        "query": {
          "connectionArgs": {
            "catalog": "__default",
            "database": "__default",
            "region": "__default",
            "resultReuseEnabled": false,
            "resultReuseMaxAgeInMinutes": 60
          },
          "format": 1,
          "rawSQL": "SELECT \n  DISTINCT(line_item_resource_id)\nFROM ${CURDatabase}.${CURTable}\nWHERE \n  $__timeFilter(line_item_usage_start_date) \n  -- line_item_usage_start_date >= (current_date - interval '3' day) --lookback period\n  AND line_item_product_code = 'AWSELB'\n  AND line_item_usage_account_id = '${AccountId}'\n  AND product_region_code = '${Region}'\n  AND resource_tags['${TagKey}'] = '${TagValue}';\n\n"
        },
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "sort": 0,
        "type": "query"
      }
    ]
  },
  "time": {
    "from": "now-6M",
    "to": "now-1440m"
  },
  "timepicker": {
    "hidden": false,
    "nowDelay": "1440m"
  },
  "timezone": "browser",
  "title": "EC2 Dashboard",
  "uid": "aer8d8juorh8gd",
  "version": 166,
  "weekStart": ""
}